!function(d,i,y){"use strict";var e,a,s,c,m,u,w,n,p=d.wp,l=d.TMEPOADMINJS,x=d.TMEPOGLOBALADMINJS,r=d.toastr,f=d._,_=d.plupload,C=!1,h={tc_builder_elements:p.template("tc-builder-elements"),tc_builder_section:p.template("tc-builder-section")},b=d.JSON,g="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",v=!0,A=!0;function O(t){var i=[];return Object.keys(t).forEach(function(e){Object.prototype.hasOwnProperty.call(t,e)&&(i[i.length]=t[e])}),i}y.tmEPOAdmin={addEventsDone:0,variationsCheckForChanges:0,elementLogicObject:{},sectionLogicObject:{},elementShippingLogicObject:{},logicOperators:{is:x.i18n_is,isnot:x.i18n_is_not,isempty:x.i18n_is_empty,isnotempty:x.i18n_is_not_empty,startswith:x.i18n_starts_with,endswith:x.i18n_ends_with,greaterthan:x.i18n_greater_than,lessthan:x.i18n_less_than,greaterthanequal:x.i18n_greater_than_equal,lessthanequal:x.i18n_less_than_equal},builderItemsSortableObj:{start:{},end:{}},builderSectionsSortableObj:{start:{},end:{}},builderSize:{},isElementDragged:!1,variationSection:!1,variationSectionIndex:!1,variationFieldIndex:!1,checkboxStates:{},canTakeLogic:["product","color","range","radiobuttons","checkboxes","selectbox","selectboxmultiple","textfield","textarea","variations"],cannotTakeSectionRepeater:["product","multiple_file_upload","template","dynamic"],currentElement:null,currentMenuElement:null,copyElement:null,contextMenuOpen:null,noMouseDownCheck:null,addSortables:function(){y.tmEPOAdmin.is_original&&(y(".builder-layout").sortablejs({handle:".move",draggable:".builder-wrapper:not(.tma-nomove)",onStart:function(e){var e=y(e.item);y(".builder-layout").addClass("dropzone has-drag"),e=e.closest(".builder-wrapper").index(),y.tmEPOAdmin.builderSectionsSortableObj.start.section=e},onEnd:function(e){var e=y(e.item);y(".builder-layout").removeClass("dropzone has-drag"),e=e.closest(".builder-wrapper").index(),y.tmEPOAdmin.builderSectionsSortableObj.end.section=e,w.splice(e,0,w.splice(y.tmEPOAdmin.builderSectionsSortableObj.start.section,1)[0]),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.builderSectionsSortableObj={start:{},end:{}}},fallbackClass:"sortable-fallback",animation:100,group:"uidrag"}),y(".builder-drag-elements").sortablejs({draggable:".ditem",setData:function(e){e.dropEffect="copy",e.effectAllowed="copy"},onStart:function(){y(".bitem-wrapper").addClass("dropzone")},onEnd:function(e){var t,e=y(e.item);y(".bitem-wrapper").removeClass("dropzone"),t=e.closest(".builder-wrapper"),y.tmEPOAdmin.builder_clone_element(e.attr("data-element"),t,"drag")},fallbackClass:"sortable-fallback",sort:!1,group:{name:"bitem",pull:"clone",put:!1}}),y(i).on("dragover",".tm-slider-wizard-header",function(){y(this).trigger("click")}),y.tmEPOAdmin.builder_items_sortable(y(".builder-wrapper .bitem-wrapper")))},getBuilder:function(){return w},getBuilderJSON:function(){return b.stringify(w)},setBuilder:function(e){w=y.epoAPI.util.deepCopyArray(y.epoAPI.util.parseJSON(e))},addEvents:function(){var e,l,o,t=y(".tagchecklist");1!==y.tmEPOAdmin.addEventsDone&&(y.tmEPOAdmin.addSortables(),e=y("#builder_import_file"),(e=new _.Uploader({url:x.import_url,browse_button:e[0],file_data_name:"builder_import_file",multi_selection:!1})).init(),e.bind("FilesAdded",function(i){function e(e,t){e={action:"import",import_override:e,post_id:x.post_id,security:x.import_nonce,is_original_post:x.is_original_post},o&&(e.tm_uploadmeta=t),y(".flasho").find(".tm-inner, .details-override, .details-append").remove(),n.appendTo("#tc-floatbox-content"),y(".tc-progress-info-content").html(x.i18n_importing),i.setOption("multipart_params",e),i.start(),y(".flasho").addClass("tc-color-notice")}var t=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.i18n_confirm_import_message+"</div>",title:x.i18n_import_title}),n=y('<div class="tc-progress-bar tc-notice"><span class="tc-percent"></span></div><div class="tc-progress-info"><span class="tc-progress-info-content"></span></div>'),a=y('<button type="button" class="tc tc-button details-override">'+x.i18n_overwrite_existing_elements+'</button><button type="button" class="tc tc-button details-append">'+x.i18n_append_new_elements+"</button>");l=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"600px",classname:"flasho tc-wrapper",data:t}),a.prependTo(".flasho .footer .inner"),w=y.tmEPOAdmin.checkSections(w),o=y.tmEPOAdmin.tm_escape(b.stringify(y.tmEPOAdmin.prepareForJson(y.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),x.is_original_post?(y(".details-override").on("click",function(){e(1)}),y(".details-append").on("click",function(){e(0,o)})):e(1,o)}),e.bind("FileUploaded",function(e,t,i){var n=y.epoAPI.util.parseJSON(i.response);n&&void 0!==n.result&&n.message&&y(".tc-progress-info-content").html(n.message),n&&n.error&&n.message&&y(".tc-progress-info-content").html(n.message),n&&void 0!==n.result&&1===y.epoAPI.math.toFloat(n.result)?(y(".tc-progress-bar").removeClass("tc-notice").addClass("tc-success"),y(".tc-progress-info-content").removeClass("tc-color-error").addClass("tc-color-success"),y(".flasho").removeClass("tc-color-notice tc-color-error").addClass("tc-color-success"),y(".floatbox-cancel").remove(),y(".tc-progress-info-content").html(x.i18n_saving),y(d).off("beforeunload.edit-post"),n.options&&(Array.isArray(n.jsobject)?(y(".builder-layout").html(n.options),w=n.jsobject,y.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),r.success(n.message,x.i18n_epo)):r.error(x.i18n_invalid_request,x.i18n_epo)),l.destroy()):(y(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),y(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error"),y(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error"),!n&&i&&i.response&&y(".tc-progress-info-content").addClass("tc-normal-font").html(i.response),r.error(x.i18n_invalid_request,x.i18n_epo))}),e.bind("UploadProgress",function(e,t){t=parseInt(t.percent,10);y(".tc-progress-bar").css("width",t+"%"),y(".tc-percent").html(t+"%")}),e.bind("Error",function(e,t){t&&t.message&&y(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error").html("\nError #"+t.code+": "+t.message),y(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),y(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error")}),e.bind("UploadComplete",function(){y("body").removeClass("overflow")}),y(i).on("click.cpf","#builder_export",function(e){var t=y(this);e.preventDefault(),t.data("doing_export")||(t.data("doing_export",1),t.find(".tcfa").removeClass("tcfa-file-export").addClass("tcfa-spin tcfa-spinner"),w=y.tmEPOAdmin.checkSections(w),e=y.tmEPOAdmin.prepareForJson(y.tmEPOAdmin.tcSerializeJsOptionsObject(w)),e={action:"tm_export",metaserialized:b.stringify(e),is_original_post:x.is_original_post,security:x.export_nonce},y.post(x.ajax_url,e,function(e){e&&e.result&&""!==e.result?d.location=e.result:e&&e.error&&e.message&&(e=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+e.message+"</div>",title:x.i18n_error_title}),y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,maxWidth:"400px",classname:"flasho tc-wrapper tm-error",data:e}))},"json").always(function(){t.data("doing_export",0),t.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("tcfa-file-export")}))}),y(i).on("click.cpf","#builder_save",function(e){var t,i,n,a=y(this);a.data("doing_export")||(a.data("doing_export",1),a.find(".tcfa").removeClass("tcfa-save").addClass("tcfa-spin tcfa-spinner"),w=y.tmEPOAdmin.checkSections(w),t={action:"tm_save",tm_uploadmeta:y.tmEPOAdmin.tm_escape(b.stringify(y.tmEPOAdmin.prepareForJson(y.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),post_id:x.post_id,security:x.save_nonce},y("#tmformfieldsbuilderwrap").addClass("disabled"),n=y.tmEPOAdmin.doConfirm({title:x.i18n_saving,template:"tc-floatbox-import",cancel:x.i18n_close},function(){i.abort()},this,[y(this)],!0),e.preventDefault(),i=y.ajax({url:x.ajax_url,type:"POST",data:t,dataType:"json",success:function(e){e&&e.result&&1===e.result?r.success(e.message,x.i18n_epo):r.error(e.message,x.i18n_epo)},error:function(e,t,i){"abort"!==t&&r.error(x.i18n_error_saving+"<p>"+i+"</p>",x.i18n_epo)}}).always(function(e){y("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&r.error(x.i18n_invalid_request,x.i18n_epo),a.data("doing_export",0),a.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("tcfa-save"),n.destroy()}))}),y(i).on("click.cpf","#builder_import,.tc-add-import-csv",function(e){e.preventDefault(),y("#builder_import_file").trigger("click")}),y(i).on("click.cpf",".tc-add-import-wpml-lang",function(e){var t=y(this),i=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.i18n_confirm_template_import_original_message+"</div>",title:x.i18n_import_title}),n=y('<button type="button" class="tc tc-button details-override">'+x.i18n_overwrite_existing_element+"</button>");e.preventDefault(),l=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"600px",classname:"flasho tc-wrapper",data:i}),n.appendTo(".flasho .footer .inner"),y(".details-override").on("click",function(){l.destroy(),function(t){var e,i,n;t.data("doing_import")||(t.data("doing_import",1),t.find(".tcfa").removeClass("file-import").addClass("tcfa-spin tcfa-spinner"),w=y.tmEPOAdmin.checkSections(w),e={action:"tm_wpml_import_original_template",post_id:x.post_id,security:x.import_nonce},y("#tmformfieldsbuilderwrap").addClass("disabled"),n=y.tmEPOAdmin.doConfirm({title:x.i18n_saving,template:"tc-floatbox-import",cancel:x.i18n_close},function(){i.abort()},this,[y(this)],!0),i=y.ajax({url:x.ajax_url,type:"POST",data:e,dataType:"json",success:function(e){e&&e.result&&1===e.result&&e.options?Array.isArray(e.jsobject)?(y(".builder-layout").html(e.options),w=e.jsobject,y.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),r.success(e.message,x.i18n_epo)):r.error(x.i18n_invalid_request,x.i18n_epo):r.error(e.message,x.i18n_epo)},error:function(e,t,i){"abort"!==t&&r.error(x.i18n_error_saving+"<p>"+i+"</p>",x.i18n_epo)}}).always(function(e){y("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&r.error(x.i18n_invalid_request,x.i18n_epo),t.data("doing_import",0),t.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("file-import"),n.destroy()}))}(t)})}),y(i).on("click.cpf","#builder-fullsize",function(e){e.preventDefault(),y("body").addClass("overflow fullsize")}),y(i).on("click.cpf","#builder-fullsize-close",function(e){e.preventDefault(),y("body").removeClass("overflow fullsize")}),y(i).on("click.cpf",".builder-add-element",y.tmEPOAdmin.builder_add_element_onClick),A&&v&&y(i).on("contextmenu",".builder-add-element",y.tmEPOAdmin.builder_add_element_onContextmenu),y(i).on("click.cpf",".builder_add_section,.tc-add-section ",y.tmEPOAdmin.builder_add_section_onClick),y(i).on("click.cpf",".builder-add-section-and-element,.tc-add-element",y.tmEPOAdmin.builder_add_section_and_element_onClick),y(i).on("click.cpf",".builder_add_variation",y.tmEPOAdmin.builder_add_variation_onClick),y(i).on("click.cpf",".builder-wrapper .section-settings .edit",y.tmEPOAdmin.builder_section_item_onClick),y(i).on("click.cpf",".builder-wrapper .section-settings .clone",y.tmEPOAdmin.builder_section_clone_onClick),y(i).on("click.cpf",".builder-wrapper .section-settings .plus",y.tmEPOAdmin.builder_section_plus_onClick),y(i).on("click.cpf",".builder-wrapper .section-settings .minus",y.tmEPOAdmin.builder_section_minus_onClick),y(i).on("click.cpf",".builder-wrapper .btitle .delete:not(.builder-wrapper.tma-variations-wrap .btitle .delete)",y.tmEPOAdmin.builder_section_delete_onClick),y(i).on("click.cpf",".builder-wrapper .btitle .fold",y.tmEPOAdmin.builder_section_fold_onClick),y(i).on("click",".builder-wrapper.tma-variations-wrap .btitle .delete",y.tmEPOAdmin.builder_variation_delete_onClick),y(i).on("click.cpf",".bitem .bitem-settings .edit",y.tmEPOAdmin.builder_item_onClick),y(i).on("click.cpf",".bitem .bitem-settings .clone",y.tmEPOAdmin.builder_clone_onClick),y(i).on("click.cpf",".bitem .bitem-settings .change",y.tmEPOAdmin.builder_change_onClick),y(i).on("click.cpf",".bitem .bitem-settings .plus",y.tmEPOAdmin.builder_plus_onClick),y(i).on("click.cpf",".bitem .bitem-settings .minus",y.tmEPOAdmin.builder_minus_onClick),y(i).on("click",".tc-actions-menu [data-action]",y.tmEPOAdmin.builder_actions_menu_onClick),A&&(y(i).on("click",".bitem .actions",y.tmEPOAdmin.builder_actions_onClick),y(i).on("contextmenu",".bitem",y.tmEPOAdmin.builder_actions_onClick),y(i).on("click",".tc-actions-menu",function(e){e.stopPropagation()}),y(i).on("mousedown",function(e){y.tmEPOAdmin.noMouseDownCheck||(y(e.target).closest(".tc-actions-menu, button.actions").length||y.tmEPOAdmin.closeContextMenu(!0,!0),!v)||y.tmEPOAdmin.contextMenuOpen||y(e.target).closest(".bitem").length||(y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null)}),y(i).on("keydown",function(e){var t=y.tmEPOAdmin.currentElement;Array.isArray(t)&&(t=y.tmEPOAdmin.currentMenuElement),"Escape"===e.key&&(y(".tc-actions-menu").length&&y.tmEPOAdmin.closeContextMenu(),y.tmEPOAdmin.copyElement&&(y(".is-copy").removeClass("is-copy"),y.tmEPOAdmin.copyElement=null),y.tmEPOAdmin.currentElement&&(y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null),y.tmEPOAdmin.noMouseDownCheck=null),y.tmEPOAdmin.currentElement?(!e.ctrlKey&&!e.metaKey||"e"!==e.key&&"E"!==e.key||(e.preventDefault(),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.builder_item_onClick(e,t),y.tmEPOAdmin.closeContextMenu(!0)),(e.ctrlKey||e.metaKey)&&"Delete"===e.key&&(e.preventDefault(),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.builder_delete_onClick(e,t),y.tmEPOAdmin.closeContextMenu(!0)),v&&(!e.ctrlKey&&!e.metaKey||"d"!==e.key&&"D"!==e.key||(e.preventDefault(),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.builder_clone_onClick(e,t),y.tmEPOAdmin.closeContextMenu(!0)),!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"C"!==e.key||(e.preventDefault(),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.builder_copy_element(e),y.tmEPOAdmin.closeContextMenu(!0)),!e.ctrlKey&&!e.metaKey||"v"!==e.key&&"V"!==e.key||(e.preventDefault(),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.builder_paste_element(e),y.tmEPOAdmin.closeContextMenu(!0)))):y.tmEPOAdmin.noMouseDownCheck=null}),v)&&y(i).on("click",".bitem",function(e){var t=y(this);e.ctrlKey||e.metaKey?y.tmEPOAdmin.currentElement?(Array.isArray(y.tmEPOAdmin.currentElement)||(y.tmEPOAdmin.currentElement=[y.tmEPOAdmin.currentElement]),y.tmEPOAdmin.currentElement.push(t)):y.tmEPOAdmin.currentElement=t:(y.tmEPOAdmin.currentElement=t,y(".bitem.selected").removeClass("selected")),(y.tmEPOAdmin.currentMenuElement=t).addClass("selected"),e.stopPropagation()}),y(i).on("click",".edit-element .tm-element-uniqid",y.tmEPOAdmin.builder_uniqid_onClick),y(i).on("click.cpf",".builder-panel-add",y.tmEPOAdmin.builder_panel_add_onClick),y(i).on("click.cpf",".builder-panel-add-separator",y.tmEPOAdmin.builder_panel_add_separator_onClick),y(i).on("click.cpf",".builder-panel-mass-add",y.tmEPOAdmin.builder_panel_mass_add_onClick),y(i).on("click.cpf",".builder-panel-populate",y.tmEPOAdmin.builder_panel_populate_onClick),y(i).on("click.cpf",".builder-image-delete",y.tmEPOAdmin.builder_image_delete_onClick),y(i).on("click.cpf",".builder_panel_delete",y.tmEPOAdmin.builder_panel_delete_onClick),y(".builder_panel_delete").on("click.cpf",y.tmEPOAdmin.builder_panel_delete_onClick),y(i).on("click.cpf",".builder_panel_delete_all",y.tmEPOAdmin.builder_panel_delete_all_onClick),y(i).on("click.cpf",".builder_panel_up",function(){var e=y(this),t=e.closest(".options-wrap");t.prev().before(t),y.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),y.tmEPOAdmin.paginattion_init("current")}),y(i).on("click.cpf",".builder_panel_down",function(){var e=y(this),t=e.closest(".options-wrap");t.next().after(t),y.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),y.tmEPOAdmin.paginattion_init("current")}),y(i).on("keyup.cpf change.cpf",".tm_option_title",function(){y(this).closest(".options-wrap").find(".tm_option_value").val(y("<div/>").html(y(this).val()).text())}),y(i).on("change.cpf changechoice",".tc-option-enabled",function(){var e=y(this);e.is(":checked")?e.closest(".options-wrap").removeClass("choice-is-disabled"):e.closest(".options-wrap").addClass("choice-is-disabled")}),y(i).on("change.cpf changednmpbq",".tc-cell-dnmpbq .c",function(){var e=y(this),t=e.closest(".options-wrap").find(".tc-cell-fee");e.is(":checked")?(t.find(".c").prop("checked",!1),t.hide()):t.show()}),y(i).on("change.cpf changefee",".tc-cell-fee .c",function(){var e=y(this),t=e.closest(".options-wrap").find(".tc-cell-dnmpbq");e.is(":checked")?(t.find(".c").prop("checked",!1),t.hide()):t.show()}),y(i).on("click.cpf",".tc-element-setting-price, .tc-element-setting-sale-price, .tm_option_price, .tm_option_sale_price",function(){var e,r,a,i,n=y(this),t=n.is(".dynamic-product-price")||n.is(".change-product-weight"),l=n.is(".override-product-price")||n.is(".change-product-weight"),o=n.is(".tc-element-setting-price, .tc-element-setting-sale-price")?y(".tm-pricetype-selector"):n.closest(".options-wrap").find(".tm_option_price_type");"math"===o.val()&&(a=function(e){for(var t,i,n,a,l=[],o=["'",'"'],d=0;d<e.length;d++)if(t=e[d],o.includes(t)){for(i=t,n=d+1;n<e.length&&e[n]!==i;)n++;d=n}else if("["===t||"{"===t)l.push(t);else if(("]"===t||"}"===t)&&(!(a=l.pop())||"]"===t&&"["!==a||"}"===t&&"{"!==a))return!1;return 0===l.length},r=function(){var e,t=d.tcmexp,i=y(".tc-element-setting-edit-price").val(),n=!0;return t&&(e=i.replace(/\{[^}]+\}|\[[^\]]+\]/g,"(0)"),!1!==(n=t.parse(e))&&a(i)?y(".tc-element-setting-edit-price").removeClass("formula-error").addClass("formula-correct"):y(".tc-element-setting-edit-price").removeClass("formula-correct").addClass("formula-error")),n},o=n.val(),e=y.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:x.i18n_save,html:'<div class="tm-inner"><textarea class="tc-element-setting-edit-price"></textarea></div>',title:x.i18n_math_formula_popup_title},"tc-floatbox-edit"),y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"50%",height:"80%",classname:"flasho tc-wrapper tc-math-popup",data:e,cancelClass:".floatbox-edit-cancel",cancelEvent:function(e){i.destroy(),e.destroy()},updateClass:".floatbox-edit-update",updateEvent:function(e){var t=y(".tc-element-setting-edit-price").val();r(),n.val(t),i.destroy(),e.destroy()},unique:!0}),e=y.tmEPOAdmin.builder_floatbox_template({update:"",html:'<div class="tm-inner"><div class="tc-price-variables"></div></div>',title:""},"tc-floatbox-edit"),i=y.tcFloatBox({classnameMain:"floatbox leger",leger:!0,closefadeouttime:0,animateOut:"",ismodal:!0,width:"30%",height:"80%",classname:"flasho tc-wrapper tc-math-popup-leger",data:e,cancelClass:".floatbox-edit-cancel",unique:!0,showoverlay:!1}),y(".tc-math-popup-leger .header, .tc-math-popup-leger .footer").remove(),y.tmEPOAdmin.populatePriceVariables(y(".tc-price-variables"),t,l),y(".tc-element-setting-edit-price").val(o),r(),y(".tc-var-field").on("click.cpf",function(e){var t=y(".tc-element-setting-edit-price"),i=t.val(),n=t[0],a=n.selectionStart,l=n.scrollTop,o=i.substring(0,a),i=i.substring(n.selectionEnd,i.length),d=y(this).attr("data-value");e.preventDefault(),t.val(o+d+i),a+=d.length,n.selectionStart=a,n.selectionEnd=a,t.trigger(" focus"),n.scrollTop=l,r()}),y(".formula-field-mode").on("change.cpf",function(){var t=y(this).val();y(".tc-var-list.other .tc-var-field").toArray().forEach(function(e){y(e).attr("data-value","{field."+y(e).attr("title")+"."+t+"}")})}),y(".tc-element-setting-edit-price").on("input.cpf",function(){r()}))}),y(i).on("click.cpf",".tc-upload-button",y.tmEPOAdmin.upload),y(i).on("change.cpf",".changes-product-image,.tm-use-lightbox,.replacement-mode",y.tmEPOAdmin.floatbox_content_js),y(i).on("change.cpf",".use_url",y.tmEPOAdmin.tm_url),y(i).on("change.cpf",".tm-pricetype-selector",y.tmEPOAdmin.tm_pricetype_selector),y(i).on("change.cpf",".tm_option_price_type",y.tmEPOAdmin.tm_option_price_type),y(i).on("change.cpf",".dynamic-mode",y.tmEPOAdmin.dynamicMode),y(i).on("change.cpf",".variations-display-as",y.tmEPOAdmin.variations_display_as),y(i).on("change.cpf",".tm-attribute .tm-changes-product-image",y.tmEPOAdmin.variations_display_as),y(i).on("change.cpf",".tm-weekday-picker",y.tmEPOAdmin.tm_weekday_picker),y(i).on("change.cpf",".tm-month-picker",y.tmEPOAdmin.tm_month_picker),y(i).on("click.cpf",".tm-tags-container .tab-header",function(){var e=y(this),t=e.closest(".tm-tags-container"),i=t.find(".tm-elements-container").find("li.tm-element-button"),t=t.find(".tab-header"),n=e.attr("data-tm-tag");t.removeClass("open").addClass("closed"),e.removeClass("closed").addClass("open"),("all"===n?i:(i.addClass("tm-hidden"),i.filter("."+n))).removeClass("tm-hidden")}),y(i).on("click.cpf",".tm_editor_wrap",function(){var e=y(this).find("textarea");e.attr("id")&&(d.wpActiveEditor=e.attr("id"))}),y(i).on("change.cpf",".cpf-logic-element",y.tmEPOAdmin.cpf_logic_element_onchange),y(i).on("change.cpf",".cpf-logic-operator",y.tmEPOAdmin.cpf_logic_operator_onchange),y(i).on("change.cpf",".activate-sections-logic, .activate-element-logic",function(){y(this).is(":checked")?y(this).closest(".message0x0").find(".builder-logic-div").show():y(this).closest(".message0x0").find(".builder-logic-div").hide()}),y(i).on("dblclick.cpf",".tm-default-radio",function(){y(this).prop("checked",!1)}),y(i).on("keypress",".tm-internal-label",function(e){13===e.which&&(e.preventDefault(),y(this).trigger("blur"))}),y(i).on("blur",".tm-internal-label",function(){var e,t=y(this),i=t.closest(".builder-wrapper").index(),n=t.closest(".tm-label-desc");n.is(".tm-for-bitem")?(e=y.tmEPOAdmin.find_index(w[i].section.is_slider,t.closest(".bitem")),y.tmEPOAdmin.setFieldValue(i,e,"internal_name",t.text(),!0)):n.is(".tm-for-section")&&(w[i].section.sections_internal_name.default=t.text(),w[i].sections_internal_name=t.text()),""===t.text()?(n.removeClass("tc-has-value").addClass("tc-empty-value"),t.html(t.attr("data-value"))):n.removeClass("tc-empty-value").addClass("tc-has-value")}),y(i).on("click.cpf",".cpf-add-rule",y.tmEPOAdmin.cpf_add_rule),y(i).on("click.cpf",".cpf-delete-rule",y.tmEPOAdmin.cpf_delete_rule),y(i).on("click.cpf",".tm-logic-add-rule-set",y.tmEPOAdmin.cpf_add_rule_set),y(i).on("click.cpf",".tma-handle-wrap .tma-handle",y.tmEPOAdmin.builder_fold_onClick),y(i).on("keyup change","#tc-floatbox-content .n[type=text]",function(){var e,t,i=y(this),n=i.val();return a&&n!==t&&(e=new RegExp("[^-0-9%.\\"+a.mon_decimal_point+"]+","gi"),t=n.replace(e,""),i.val(t),0===i.parent().find(".wc_error_tip").length)&&(n=i.position(),i.after('<div class="wc_error_tip">'+a.i18n_mon_decimal_error+"</div>"),y(".wc_error_tip").css("left",n.left+i.width()-i.width()/2-y(".wc_error_tip").width()/2).css("top",n.top+i.height()).fadeIn("100")),this}),y(i).on("click",".tc-enable-responsive",function(){var e=y(this),t=e.find(".on"),i=e.find(".off"),n=y("#tc-floatbox-content").find(".builder_responsive_div");e.is(".active")?(e.removeClass("active"),t.addClass("tc-hidden"),i.removeClass("tc-hidden"),n.addClass("tc-hidden")):(e.addClass("active"),t.removeClass("tc-hidden"),i.addClass("tc-hidden"),n.removeClass("tc-hidden"))}),y(i).on("change.cpf",".product-mode",function(){var e=y("#tc-floatbox-content"),t=y(this).val(),i=y(".product-default-value-search"),n=y(".product-products-selector");"product"===t?(t="products",n.is(".enhanced")&&n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!1),y.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!1)):"products"===t&&(n.is(".enhanced")&&!n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!0),y.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!0)),i.is(".enhanced")&&(i.selectWoo("destroy").removeClass("enhanced"),"products"===t?(i.removeData("action"),i.addClass("enhanced-dropdown"),n.triggerHandler("change.cpf"),y.tmEPOAdmin.create_enhanced_dropdown(e)):(i.data("action","wc_epo_search_products_in_categories"),i.addClass("wc-product-search"),y.tmEPOAdmin.create_products_search(e))),y(".product-"+t+"-selector").trigger("change.cpf")}),y(i).on("change.cpf",".product-default-value-search",function(){var i,n,t=y(this),a=t.val(),l=y(".product-mode"),e={action:"wc_epo_get_product_categories",product_id:a,security:x.get_products_categories_nonce};a&&y.post(x.ajax_url,e,function(e){t.data("categoryIds","success"===e.result?e.category_ids:[]),t.data("categoryIds")&&("categories"!==l.val()||a===t.attr("data-current-selected")||(i=y(".product-categories-selector").find(":selected").toArray().map(function(e){return parseInt(y(e).val(),10)}),n=!1,y.each(t.data("categoryIds"),function(e,t){if(-1!==y.inArray(parseInt(t,10),i))return!(n=!0)}),n)?(t.attr("data-current-selected",a),t.data("current-selected-text",t.find(":selected").text())):(t.find("option").remove(),this.removeAttr("data-current-selected"),this.removeData("current-selected-text"),this.removeData("categoryIds"),this.removeData("include")))})}),y(i).on("change.cpf",".product-products-selector",function(){var e=y(this),t=y(".product-default-value-search"),e=e.find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id");t.removeData("action"),t.find("option").remove(),t.append(e),t.val(t.attr("data-current-selected")).trigger("change.cpf")}),y(i).on("change.cpf",".product-categories-selector",function(){var i,n=y(this).find(":selected").toArray().map(function(e){return parseInt(y(e).val(),10)}),e=y(".product-default-value-search");e.data("include",n),e.data("action","wc_epo_search_products_in_categories"),e.data("categoryIds")&&(i=!1,y.each(e.data("categoryIds"),function(e,t){if(-1!==y.inArray(parseInt(t,10),n))return!(i=!0)}),i||(e.find("option").remove(),e.removeAttr("data-current-selected"),e.removeData("current-selected-text"),e.removeData("categoryIds")))}),y("body").on("woocommerce-product-type-change",function(){var e=y("#product-type");y.tmEPOAdmin.initSectionsCheck(),e.length&&("variable"!==e.val()&&"variable-subscription"!==e.val()&&(e=y(".builder-layout .element-variations")).length&&(e.closest(".builder-wrapper").remove(),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck(),y.tmEPOAdmin.toggleVariationButton(),y.tmEPOAdmin.var_remove("tm-style-variation-added")),y.tmEPOAdmin.toggleVariationButton())}),y(i).on("change.cpf",".apply-mode, .product_page_tm-global-epo #product_catdiv input:checkbox, .product_page_tm-global-epo #tm-product-ids, .product_page_tm-global-epo #tc-enabled-options, .product_page_tm-global-epo #tc-disabled-options",function(){setTimeout(function(){y.tmEPOAdmin.checkIfApplied()},100)}),y(i).on("change.cpf",".apply-mode",function(){y.tmEPOAdmin.applyMode(y(this))}),y('#product_catchecklist input[type="checkbox"]').on("change",function(){y.tmEPOAdmin.checkboxStates[this.id]=y(this).prop("checked"),setTimeout(function(){y.tmEPOAdmin.applyMode(y(".apply-mode:checked"))},100)}),t.length&&t.toArray().forEach(function(e){new MutationObserver(function(){y.tmEPOAdmin.checkIfApplied()}).observe(e,{attributes:!0,childList:!0,subtree:!0})}),y.tmEPOAdmin.addEventsDone=1)},closeContextMenu:function(e,t){e||(y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null,y.tmEPOAdmin.noMouseDownCheck=null),t?(y(".menu-active").removeClass("menu-active"),y(".tc-actions-menu").remove()):y(".tc-actions-menu").removeClass("tm-animated fadein").stop().animate({opacity:0},150,"easeOutExpo",function(){y(".menu-active").removeClass("menu-active"),y(".tc-actions-menu").remove()}),y.tmEPOAdmin.contextMenuOpen=null},initialitize:function(){y.tmEPOAdmin.setGlobalVariationObject("initialitize_on")},initialitize_on:function(){y.tmEPOAdmin.isinit=!0,y.tmEPOAdmin.pre_element_logic_init_obj={},y.tmEPOAdmin.pre_element_logic_init_obj_options={},y.tmEPOAdmin.pre_element_logic_init(!0),y.tmEPOAdmin.pre_element_logic_init_done=!0,y.tmEPOAdmin.is_original=x.is_original_post,y.tmEPOAdmin.toggleVariationButton(),y.tmEPOAdmin.addEvents(),y.tmEPOAdmin.check_section_logic(),y.tmEPOAdmin.check_element_logic(),y.tmEPOAdmin.sectionLogicStart(),y.tmEPOAdmin.elementLogicStart(),y(".builder-wrapper.tm-slider-wizard").each(function(){var e=y(this);y.tmEPOAdmin.createSlider(e)}),l||y("#side-sortables").prepend(y('<div class="tc-info-box hidden"></div>')),y(function(){y.tmEPOAdmin.checkIfApplied(),y.tmEPOAdmin.applyModeInit(),y.tmEPOAdmin.checkboxStates={},y('#product_catchecklist input[type="checkbox"]').each(function(){y.tmEPOAdmin.checkboxStates[this.id]=y(this).prop("checked")})}),y.tmEPOAdmin.initSectionsCheck(),y.tmEPOAdmin.fixFormSubmit(),y.tmEPOAdmin.pre_element_logic_init_done=!1,y.tmEPOAdmin.isinit=!1,y(".builder-layout").removeClass("tm-hidden"),y.tmEPOAdmin.makeResizables(y(".builder-wrapper")),y.tmEPOAdmin.makeResizables(y(".bitem"))},initialitize_on_after:function(){y.tmEPOAdmin.isinit=!0,y.tmEPOAdmin.pre_element_logic_init_obj={},y.tmEPOAdmin.pre_element_logic_init_obj_options={},y.tmEPOAdmin.pre_element_logic_init(!0),y.tmEPOAdmin.pre_element_logic_init_done=!0,y.tmEPOAdmin.is_original=x.is_original_post,y.tmEPOAdmin.var_remove("tm-style-variation-added"),y.tmEPOAdmin.toggleVariationButton(),y.tmEPOAdmin.addSortables(),y.tmEPOAdmin.check_section_logic(),y.tmEPOAdmin.check_element_logic(),y.tmEPOAdmin.sectionLogicStart(),y.tmEPOAdmin.elementLogicStart(),y(".builder-wrapper.tm-slider-wizard").each(function(){var e=y(this);y.tmEPOAdmin.createSlider(e)}),y.tmEPOAdmin.initSectionsCheck(),y.tmEPOAdmin.fixFormSubmit(),y.tmEPOAdmin.makeResizables(y(".builder-wrapper")),y.tmEPOAdmin.makeResizables(y(".bitem")),y.tmEPOAdmin.pre_element_logic_init_done=!1,y.tmEPOAdmin.isinit=!1},makeResizables:function(e){var s,t=Object.keys(y.tmEPOAdmin.builderSize),c=[];0!==(e=y(e)).length&&(e.toArray().forEach(function(e){(e=y(e)).css("--flex-width",e.attr("data-size"))}),x.is_original_post)&&!e.closest(".builder-layout").is(".builder-template")&&(t.forEach(function(e){c.push(parseFloat(y.tmEPOAdmin.builderSize[e].replace("%",""),10))}),e.not(".tma-nomove").toArray().forEach(function(d){var r;d=y(d),r=d.is(".bitem")?d.closest(".bitem-wrapper").first():d.closest(".builder-layout"),d.is(".ui-resizable")&&d.resizable().resizable("destroy"),d.resizable({maxWidth:r.width(),minWidth:r.width()/8,start:function(e,t){s=parseFloat(y.tmEPOAdmin.builderSize[t.originalElement.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0]].replace("%",""),10),t.originalElement.addClass("flex-reset")},stop:function(e,t){var i,n,a=100*t.size.width/r.width(),l=c.filter(function(e){return e<=a}),o=c.filter(function(e){return a<=e}),t=t.originalElement;t.removeClass("ui-highlight"),l=l[l.length-1],o=((o=void 0===(o=o[0])?c[c.length-1]:o)-(l=void 0===l?o<=s?c[c.length-1]:c[1]:l))/2<a-l?(i="w"+o.toString().replace(".","-"),t.css("width",o+"%"),o):(i="w"+l.toString().replace(".","-"),t.css("width",l+"%"),l),l=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=y.tmEPOAdmin.builderSize[i],i!==l&&(t.removeClass(String(l)),t.addClass(String(i)),t.removeClass("flex-reset"),t.css("--flex-width",String(o)),t.attr("data-size",o),(d.is(".bitem")?t.find(".bitem-inner .size"):t.find(".section-inner .size")).text(n),l=t.closest(".builder-wrapper").index(),o=y.tmEPOAdmin.find_index(w[l].section.is_slider,t),d.is(".bitem")?y.tmEPOAdmin.setFieldValue(l,o,"div_size",i):(w[l].section.sections_size.default=i,w[l].size=n)),d.is(".builder-wrapper")&&y.tmEPOAdmin.makeResizables(d.find(".bitem")),(t.is(".bitem")?t.find(".bitem-settings"):t.find(".section-settings")).removeClass("show")},resize:function(e,t){var i=100*t.size.width/r.width(),n=c.filter(function(e){return e<=i}),a=t.originalElement;void 0===(n=n[n.length-1])&&(n=c[c.length-1]),a.addClass("ui-highlight"),(a.is(".bitem")?a.find(".bitem-settings").addClass("show").find(".bitem-setting.size"):a.find(".section-settings").addClass("show").find(".section-setting.size")).html(n+"%"),t.size.height=t.originalSize.height}})}))},cpf_logic_element_onchange:function(e,t){var i,n,a,l,o,d,r,s,c=y(this),m="tc-hidden-no-events";e instanceof y&&(c=e),e=(t=void 0===t?!(t=y(this).closest(".section_elements, .builder-wrapper, .bitem, .builder-element-wrap")).is(".section_elements")&&!t.is(".builder-wrapper"):t)?2===t?y.tmEPOAdmin.elementShippingLogicObject:y.tmEPOAdmin.elementLogicObject:y.tmEPOAdmin.sectionLogicObject,t=c.val(),i=c.find("option:selected").attr("data-section"),n=c.find("option:selected").attr("data-type"),a=void 0!==(a=e)[i]&&void 0!==(a=e[i].values)[t]&&e[i].values[t],e=c.closest(".tm-logic-rule").find(".tm-logic-value"),l=(c=c.closest(".tm-logic-rule").find(".cpf-logic-operator")).val(),r=["startswith","endswith","isempty","isnotempty"],s=["startswith","endswith","greaterthan","lessthan","greaterthanequal","lessthanequal","isempty","isnotempty"],d=(o=["startswith","endswith","greaterthan","lessthan","greaterthanequal","lessthanequal"]).concat("is","isnot"),a?(a=y(a),e.empty().append(a),c.children().removeClass(m),"quantity"===n?(-1!==y.inArray(l,r)&&c.val("is"),c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),r)}).addClass(m),c.trigger("change.cpf")):"productid"===n?(-1!==y.inArray(l,s)&&c.val("is"),c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),s)}).addClass(m),c.trigger("change.cpf")):"variation"===n||"variationattributes"===n||"multiple"===n?(-1!==y.inArray(l,o)&&c.val("isempty"),c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),o)}).addClass(m),c.trigger("change.cpf")):c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),o)}).removeClass(m)):t===i?(-1!==y.inArray(l,d)&&c.val("isempty"),c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),d)}).addClass(m),c.trigger("change.cpf")):c.children().filter(function(e,t){return-1!==y.inArray(y(t).val(),d)}).removeClass(m)},cpf_logic_operator_onchange:function(e){var t=y(this),e=(t=e instanceof y?e:t).val(),t=t.closest(".tm-logic-rule").find(".tm-logic-value");"isempty"===e||"isnotempty"===e?t.addClass("tm-hidden-inline"):t.removeClass("tm-hidden-inline")},createSlider:function(d){d.tmtabs({headers:"tm-slider-wizard-headers",header:"tm-slider-wizard-header",selectedtab:0,showonhover:function(){return y.tmEPOAdmin.isElementDragged},useclasstohide:!0,afteraddtab:function(e,t){var i,n,a=d.index();y.tmEPOAdmin.builder_items_sortable(t),d.is(".tm-slider-wizard")?(i=d.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(","),n=w[a].section.sections_tabs_labels.default||"null",(n=(n=y.epoAPI.util.parseJSON(n))||[]).push(y(e).text()),n=b.stringify(n)):(i="",(n=[]).push(y(e).text())),w[a].section.sections_slides.default=i,w[a].section.sections_tabs_labels.default=n},deletebutton:!0,deleteconfirm:!0,beforedeletetab:function(e,t){var i=d.index(),n=t.find(".bitem").length,a=y.tmEPOAdmin.find_index(!0,t.find(".bitem").first());y.tmEPOAdmin.sliderTabDeleteBefore=[],t.find(".bitem").toArray().forEach(function(e){y.tmEPOAdmin.sliderTabDeleteBefore.push({field_index:y.tmEPOAdmin.find_index(!0,y(e)),disabledFieldIndex:y.tmEPOAdmin.find_index(!0,y(e),".bitem",".element-is-disabled")})}),w[i].fields.splice(a,n),w[i].section.sections.default=parseInt(w[i].section.sections.default,10)-n,w[i].section.sections.default=w[i].section.sections.default.toString(),t=w[i].section.sections_tabs_labels.default||"null",t=(t=y.epoAPI.util.parseJSON(t))||[],a=e.closest(".tm-box").index(),t.splice(a,1),t=b.stringify(t),w[i].section.sections_tabs_labels.default=t},afterdeletetab:function(){var e,i=d.index(),n=0,t=d.is(".tm-slider-wizard")?d.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(","):"";d.is(".is-slider")&&(e=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){y(e).find(".tab-text").html(y(e).closest(".tm-box").index()+1)}),e=b.stringify(e),w[i].section.sections_tabs_labels.default=e),w[i].section.sections_slides.default=t,y.tmEPOAdmin.sliderTabDeleteBefore.forEach(function(e,t){y.tmEPOAdmin.builderItemsSortableObj.start.section=w[i].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.start.section_eq=i.toString(),y.tmEPOAdmin.builderItemsSortableObj.start.element=-1===y.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex?"-1":parseInt(y.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex,10)-t+n,-1===y.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex&&(y.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,y.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=-1,n+=1),y.tmEPOAdmin.builderItemsSortableObj.end.section="delete",y.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",y.tmEPOAdmin.builderItemsSortableObj.end.element="delete",y.tmEPOAdmin.builderItemsSortableObj.end.novalidate="delete",y.tmEPOAdmin.logic_reindex()}),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck()},aftermovetab:function(e,t){var i,n=d.index();w[n].section.sections_slides.default=y(".builder-wrapper").eq(n).find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(","),i=w[n].section.sections_tabs_labels.default||"null",t=(i=(i=y.epoAPI.util.parseJSON(i))||[]).splice(t,1)[0],i.splice(e,0,t),i=b.stringify(i),w[n].section.sections_tabs_labels.default=i,y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck(),d.is(".is-slider")&&(i=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){var t=y(e).closest(".tm-box").index()+1;y(e).find(".tab-text").html(t),i.push(t)}),i=b.stringify(i),w[n].section.sections_tabs_labels.default=i)},beforemovebitem:function(e,t,i,n,a){var l=d.index();y.tmEPOAdmin.builderItemsSortableObj.start.section=w[l].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),y.tmEPOAdmin.builderItemsSortableObj.start.element=y.tmEPOAdmin.find_index(!0,a).toString(),y.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=y.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled")},aftermovebitem:function(e,t,i,n,a){var l=d.index(),o=y.tmEPOAdmin.find_index(!0,a);y.tmEPOAdmin.builderItemsSortableObj.end.section=w[l].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),y.tmEPOAdmin.builderItemsSortableObj.end.element=y.tmEPOAdmin.find_index(!0,a).toString(),y.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=y.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled"),w[l].fields.splice(o,0,w[y.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(y.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.logic_reindex()},editbutton:d.is(".is-tabs"),oneditbutton:function(t){var i=d.index(),n=w[i].section.sections_tabs_labels.default||"null",a=t.closest(".tm-box").index(),e=y.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:x.i18n_save,html:'<div class="tm-inner"><input type="text" class="tc-element-setting-edit-tab"></div>',title:x.i18n_edit_tab},"tc-floatbox-edit"),l=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,minWidth:"400px",classname:"flasho tc-wrapper",data:e,cancelClass:".floatbox-edit-cancel",unique:!0}),o=this;n=(n=y.epoAPI.util.parseJSON(n))||[],y(".tc-element-setting-edit-tab").val(n[a]),y(".floatbox-edit-update").on("click.cpf",function(e){e.preventDefault(),n[a]=y(".tc-element-setting-edit-tab").val(),t.closest(".tm-slider-wizard-header").find(".tab-text").html(n[a]),n=b.stringify(n),w[i].section.sections_tabs_labels.default=n,l.destroy(),o.trigger("refresh")})},addbutton:!!y.tmEPOAdmin.is_original}),w[d.index()].section.is_slider=!0},sections_type_onChange:function(d){var e,t,i,n=w[d].section.sections_type.default,r=y(".builder-wrapper").eq(d);"slider"!==n&&"tabs"!==n||!r.hasClass("tm-slider-wizard")?"slider"!==n&&"tabs"!==n||r.hasClass("tm-slider-wizard")?"slider"!==n&&"tabs"!==n&&r.hasClass("tm-slider-wizard")&&(r.find(".bitem-wrapper").wrapAll('<div class="tmtemp"></div>'),r.find(".bitem-wrapper .bitem").appendTo(r.find(".tmtemp")),r.find(".bitem-wrapper").remove(),r.find(".tmtemp").addClass("bitem-wrapper").removeClass("tmtemp"),y.tmEPOAdmin.builder_items_sortable(r.find(".bitem-wrapper")),r.find(".tm-slider-wizard-headers").remove(),r.find(".tc-tab-headers-wrap").remove(),r.removeClass("tm-slider-wizard is-tabs is-slider has-add-button"),r.removeData("tctabs").removeData("tmHasTmtabs"),w[d].section.sections_slides.default="",w[d].section.sections_tabs_labels.default="",w[d].section.is_slider=!1):(e=r.find(".bitem-wrapper"),i=r.find(".btitle"),r.addClass("tm-slider-wizard is-"+n),i.after('<div class="transition tm-slider-wizard-headers"><div class="transition tm-slider-wizard-headers-inner"><div class="tm-box"><h4 class="tm-slider-wizard-header" data-id="tc-tab-slide0"><span class="tab-text">1</span></h4></div></div></div>'),e.addClass("tc-tab-slide tc-tab-slide0"),y.tmEPOAdmin.createSlider(r),w[d].section.sections_slides.default=r.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(","),w[d].section.is_slider=!0,w[d].section.sections_tabs_labels.default=b.stringify(["1"])):r.is(".is-slider")&&"tabs"===n?(t=[],r.find(".tc-scroll-left-arrow, .tc-scroll-right-arrow, .tm-add-tab").remove(),r.find(".tm-slider-wizard-header").toArray().forEach(function(e){e=y(e).find(".tab-text");void 0!==e.data("tabtext")&&e.html(e.data("tabtext")),t.push(e.text())}),t=b.stringify(t),r.find(".tm-slider-wizard-headers").unwrap(),r.removeClass("is-slider").addClass("is-tabs").tcTabs("set",{editbutton:!0}),w[d].section.sections_tabs_labels.default=t):r.is(".is-tabs")&&"slider"===n&&(r.find(".tc-scroll-left-arrow, .tc-scroll-right-arrow, .tm-add-tab").remove(),r.find(".tm-slider-wizard-headers").unwrap(),r.removeClass("is-tabs has-add-button").addClass("is-slider").tcTabs("set",{editbutton:!1}),r.find(".tm-slider-wizard-header").toArray().forEach(function(e){var e=y(e),t=e.find(".tab-text"),e=e.closest(".tm-box").index()+1;t.data("tabtext",t.text()),t.html(e)}),w[d].section.sections_tabs_labels.default=""),Object.keys(w[d].fields).forEach(function(e){var t,i,n,a,l=w[d].fields[e],o=y.tmEPOAdmin.getFieldValue(l,"element_type");-1!==y.inArray(o,y.tmEPOAdmin.cannotTakeSectionRepeater)&&(void 0===(n=y.tmEPOAdmin.getFieldValue(l,"shadow_enabled",o))&&(n="2"),t=y.tmEPOAdmin.getFieldValue(l,"logic",o),i=w[d].section.is_slider,l=y.tmEPOAdmin.getFieldValue(l,"enabled",o),a=r.find(".bitem").eq(e),w[d].section.sections_repeater.default?(y.tmEPOAdmin.setFieldValue(d,e,"enabled","",o),y.tmEPOAdmin.setFieldValue(d,e,"shadow_enabled",l,o),""!==l&&(a.addClass("element-is-disabled"),y.tmEPOAdmin.after_element_enabled_change("",t,d,e,a,i))):"2"!==n&&n!==l&&(y.tmEPOAdmin.setFieldValue(d,e,"enabled",n,o),y.tmEPOAdmin.setFieldValue(d,e,"shadow_enabled","2",o),"0"===n?a.addClass("element-is-disabled"):a.removeClass("element-is-disabled"),y.tmEPOAdmin.after_element_enabled_change(n,t,d,e,a,i)))})},variationEventsSuccess:function(){setTimeout(function(){y.tmEPOAdmin.setGlobalVariationObject("reindex")},600),y(i).unbind("ajaxSuccess",y.tmEPOAdmin.variationEventsSuccess),y.tmEPOAdmin.var_remove("tma-remove_variation-added")},variationsCheckEventsSuccess:function(){setTimeout(function(){y.tmEPOAdmin.variationsCheckForChanges=1,y.tmEPOAdmin.tm_variations_check()},600),y(i).unbind("ajaxSuccess",y.tmEPOAdmin.variationsCheckEventsSuccess),y.tmEPOAdmin.var_remove("tma-remove_variation-added")},addVariationEvents:function(){!0!==y.tmEPOAdmin.var_is("tma-variation-events-added")&&(!0!==y.tmEPOAdmin.var_is("tma-remove_variation-added")&&y("#variable_product_options").on("click.tma",".remove_variation",function(){y(i).ajaxSuccess(y.tmEPOAdmin.variationEventsSuccess),y.tmEPOAdmin.var_is("tma-remove_variation-added",!0),y(i).ajaxSuccess(y.tmEPOAdmin.variationsCheckEventsSuccess)}),!0!==y.tmEPOAdmin.var_is("tma-remove_variation-added")&&y(".wc-metaboxes-wrapper").on("click","a.bulk_edit",function(){"delete_all"===y("select#field_to_edit").val()&&(y(i).ajaxSuccess(y.tmEPOAdmin.variationEventsSuccess),y.tmEPOAdmin.var_is("tma-remove_variation-added",!0),y(i).ajaxSuccess(y.tmEPOAdmin.variationsCheckEventsSuccess))}),y("#variable_product_options").on("woocommerce_variations_added",function(){y.tmEPOAdmin.setGlobalVariationObject("reindex"),y(i).ajaxSuccess(y.tmEPOAdmin.variationsCheckEventsSuccess)}),y("#woocommerce-product-data").on("woocommerce_variations_saved",function(){y.tmEPOAdmin.setGlobalVariationObject("reindex"),y(i).ajaxSuccess(y.tmEPOAdmin.variationsCheckEventsSuccess)}),y(i).on("click.cpf",".save_attributes",function(){y(i).ajaxSuccess(y.tmEPOAdmin.variationsCheckEventsSuccess)}),y.tmEPOAdmin.var_is("tma-variation-events-added",!0))},toggleVariationButton:function(){var e,t,i=y("#product-type");i.length&&("variable"===i.val()||"variable-subscription"===i.val()?(y(".builder_add_section").addClass("inline"),y(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),y(".tma-variations-wrap").removeClass("tm-hidden"),y.tmEPOAdmin.addVariationEvents(),i=!1,(e=y(".builder-layout .element-variations")).length?"1"===y.tmEPOAdmin.getFieldValue(y.tmEPOAdmin.variationSection,"variations_disabled")&&(i=!0,e=y(".builder-layout .element-variations"),y.tmEPOAdmin.var_is("tm-style-variation-forced",!0)):(y.tmEPOAdmin.var_is("tm-style-variation-forced",!0),y.tmEPOAdmin.builder_add_variation_onClick(),i=!0,e=y(".builder-layout .element-variations")),e.length&&((t=e.closest(".builder-wrapper")).find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),t.addClass("tma-nomove tma-variations-wrap"),y.tmEPOAdmin.var_is("tm-style-variation-added",!0),e.addClass("tma-nomove"),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.change,.bitem-settings .minus,.tm-label-actions").remove(),i?(y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),y(".builder_add_section").addClass("inline"),y(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),y(".tma-variations-wrap").addClass("tm-hidden")):(y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),y(".builder_add_section").removeClass("inline"),y(".builder_add_variation").removeClass("inline").addClass("tm-hidden"),y(".tma-variations-wrap").removeClass("tm-hidden")),y.tmEPOAdmin.variationsCheckForChanges=1,y.tmEPOAdmin.tm_variations_check()),1<y(".tma-variations-wrap").length&&y(".tma-variations-wrap").not(":first").each(function(){var e=y(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck()})):(y(".builder_add_section").removeClass("inline"),y(".builder_add_variation").removeClass("inline").addClass("tm-hidden")))},tcSerializeJsOptionsArray:function(e){var t=[].concat.apply([],e.map(function(t){return Object.keys(t.section).map(function(e){return t&&"object"==typeof t.section[e]?t.section[e]:null}).filter(function(e){return null!=e})})),i=[].concat.apply([],e.map(function(e){return[].concat.apply([],e.fields.map(function(e){return[].concat.apply([],e.filter(function(e){return null!==e}).map(function(e){return e&&"multiple"===e.id?[].concat.apply([],e.multiple):e}))}))}));return e=(e=[].concat.apply([],[t,i])).map(function(e){return e?void 0===e.checked||!0===e.checked?{name:e.tags.name,value:e.default}:{name:e.tags.name,value:""}:{}}).filter(function(e){return null!=e})},tcSerializeJsOptionsObject:function(e){var t={},e=y.tmEPOAdmin.tcSerializeJsOptionsArray(e);return y("#tm_meta_priority").length&&e.push({name:"tm_meta[priority]",value:y("#tm_meta_priority").val()}),y.each(e,function(){void 0!==t[this.name]?"[]"===this.name.slice(-2)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(y.epoAPI.util.clenValue(this.value))):""===t[this.name]&&(t[this.name]=y.epoAPI.util.clenValue(this.value)):null!==this.value&&void 0!==this.value&&this.value.push?t[this.name]=[this.value]:t[this.name]=y.epoAPI.util.clenValue(this.value)}),t},checkSections:function(t){return Object.keys(t).forEach(function(e){t[e].section.sections.default=t[e].fields.length||0}),t},prepareForJson:function(t){var i,n,a={};return Object.keys(t).forEach(function(e){0===e.indexOf("tm_meta[")&&((i=e.split(/[[\]]{1,2}/)).pop(),i=i.map(function(e){return""===e?null:e}),n=0<i.length&&null===i[i.length-1],i=i.filter(function(e){return null!=e?e:null}),n="object"!=typeof t[e]&&n?[t[e]]:t[e],a=y.tmEPOAdmin.constructObject(i,n,a))}),a},constructObject:function(e,t,i){var n=e.shift();return 0<e.length?(Object.prototype.hasOwnProperty.call(i,n)||(i[n]={}),i[n]=y.tmEPOAdmin.constructObject(e,t,i[n])):i[n]=t,i},createTmMetaSerialized:function(){var e,t,i=y("input#wp-preview"),n=y("#tmformfieldsbuilderwrap");y(".tm_meta_serialized").remove(),y(".tm_meta_serialized_wpml").remove(),t=y.tmEPOAdmin.is_original?"tm_meta_serialized":"tm_meta_serialized_wpml",w=y.tmEPOAdmin.checkSections(w),e=y.tmEPOAdmin.tm_escape(b.stringify(y.tmEPOAdmin.prepareForJson(y.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),t=y("<textarea class='tm_meta_serialized tm-hidden' name='"+t+"'></textarea>").val(e),n.prepend(t),0<i.length&&""!==i.val()&&y(".tm_meta_serialized").remove()},fixFormSubmit:function(){var n,e=y("#post");1===e.length?e.on("submit",function(){return y.tmEPOAdmin.createTmMetaSerialized(),!0}):p.data&&void 0!==p.data.subscribe&&(n=!1,"function"==typeof(e=p.data.subscribe))&&e(function(){var e,t,i;p.data.select("core/editor")&&(t=p.data.select("core/editor").didPostSaveRequestSucceed(),i=p.data.select("core/editor").didPostSaveRequestFail(),p&&p.data&&p.data.select("core/editor")&&(e=p.data.select("core/editor").isSavingPost()),!n&&e&&(n=!0,y.tmEPOAdmin.createTmMetaSerialized()),n)&&(t||i)&&(n=!1,setTimeout(function(){y(".tm_meta_serialized").remove(),y(".tm_meta_serialized_wpml").remove()},600))})},initSectionsCheck:function(){var e=y(".builder-wrapper").length;(e=1===e&&y(".builder-wrapper.tma-variations-wrap.tm-hidden").length?0:e)?(y(".builder-add-section-action").show(),y(".builder-selector").show(),y(".tc-welcome").hide(),y(".builder-layout-wrapper").removeClass("tm-hidden")):(y(".builder-add-section-action").hide(),y(".builder-selector").hide(),y(".tc-welcome").show(),y(".builder-layout-wrapper").addClass("tm-hidden"))},applyModeInit:function(){setTimeout(function(){y.tmEPOAdmin.applyMode(y(".apply-mode:checked"))},100)},applyMode:function(e){var t,i,e=e.val(),n="disable-form"===e||"customize-selection"===e&&!y("#product_catchecklist :checkbox:checked").length?1:0,a=y("#tm-product-ids"),l=y("#tm-product-exclude-ids"),o=y("#tc-enabled-options"),d=y("#tc-disabled-options");if("apply-to-all-products"===e)y("#product_catchecklist").find(":checkbox").prop("checked",!1);else for(t in y.tmEPOAdmin.checkboxStates)y("#"+t).prop("checked",y.tmEPOAdmin.checkboxStates[t]);"apply-to-all-products"===e||"customize-selection"===e?((i=l.data("saved-exclude-ids"))&&i.length&&(l.html(y.map(i,function(e){return e.html}).join("")),l.find("option").each(function(e){i[e].checked&&y(this).prop("selected",!0)}),l.removeData("saved-exclude-ids")),(i=o.data("saved-enabled-roles"))&&i.length&&(o.html(y.map(i,function(e){return e.html}).join("")),o.find("option").each(function(e){i[e].checked&&y(this).prop("selected",!0)}),o.removeData("saved-enabled-roles")),(i=d.data("saved-disabled-roles"))&&i.length&&(d.html(y.map(i,function(e){return e.html}).join("")),d.find("option").each(function(e){i[e].checked&&y(this).prop("selected",!0)}),d.removeData("saved-disabled-roles"))):"disable-form"===e&&(i=l.find("option").map(function(){return{html:y(this).prop("outerHTML"),checked:y(this).prop("selected")}}).get(),l.data("saved-exclude-ids",i),l.html(""),i=o.find("option").map(function(){return{html:y(this).prop("outerHTML"),checked:y(this).prop("selected")}}).get(),o.data("saved-enabled-roles",i),o.html(""),i=d.find("option").map(function(){return{html:y(this).prop("outerHTML"),checked:y(this).prop("selected")}}).get(),d.data("saved-disabled-roles",i),d.html("")),"customize-selection"===e?(i=a.data("saved-include-ids"))&&i.length&&(a.html(y.map(i,function(e){return e.html}).join("")),a.find("option").each(function(e){i[e].checked&&y(this).prop("selected",!0)}),a.removeData("saved-include-ids")):"apply-to-all-products"!==e&&"disable-form"!==e||(i=a.data("saved-include-ids"))&&i.length||(i=a.find("option").map(function(){return{html:y(this).prop("outerHTML"),checked:y(this).prop("selected")}}).get(),a.data("saved-include-ids",i),a.html("")),"apply-to-all-products"===e?(y("#product_catdiv").hide(),y('.postbox[id^="tagsdiv-"]').hide(),y("#tc-product-search").hide(),y("#tc-product-exclude").show(),y("#tc-product-roles").show()):"customize-selection"===e?(y("#product_catdiv").show(),y('.postbox[id^="tagsdiv-"]').show(),y("#tc-product-search").show(),y("#tc-product-exclude").show(),y("#tc-product-roles").show()):"disable-form"===e&&(y("#product_catdiv").hide(),y('.postbox[id^="tagsdiv-"]').hide(),y("#tc-product-search").hide(),y("#tc-product-exclude").hide(),y("#tc-product-roles").hide()),y("#tm_meta_disable_categories").val(n)},checkIfApplied:function(){var e,t,i,n,a;y("body").is(".product_page_tm-global-epo")&&(e=y(".apply-mode:checked").val(),t=0<y("#product_catdiv input:checkbox").filter(":checked").length,a=0<y(".tagchecklist").children("li").length,i=y("#tm-product-ids").val(),n=y("#tc-enabled-options").val(),i=!(!i||null===i)&&0<i.length,n=!(!n||null===n)&&0<n.length,"apply-to-all-products"===e?y(".tc-info-box").removeClass("hidden error").addClass("tc-all-products").html(x.i18n_form_is_applied_to_all):"customize-selection"===e&&(t||a||i||n)?y(".tc-info-box").removeClass("tc-error tc-all-products").addClass("hidden").html(""):y(".tc-info-box").removeClass("hidden tc-all-products").addClass("tc-error").html(x.i18n_form_not_applied_to_all))},check_section_logic:function(e){var i;!(Number.isFinite(e)||e instanceof y)&&y.tmEPOAdmin.isinit&&y.tmEPOAdmin.done_check_section_logic||(void 0===(e=e instanceof y?parseInt(e.index(),10):e)?i=w:(i=[],e=y.epoAPI.math.toFloat(e),i[e]=w[e]),Object.keys(i).forEach(function(e){var t=i[e];void 0===t.section||(t=t.section.sections_uniqid.default)&&""!==t&&void 0!==t&&!1!==t||(w[e].section.sections_uniqid.default=y.epoAPI.math.uniqueid("",!0))}),y.tmEPOAdmin.done_check_section_logic=!0)},check_element_logic:function(e,t){var n,a,l,o,d=[],r=!1;!(Number.isFinite(e)||e instanceof y)&&y.tmEPOAdmin.isinit&&y.tmEPOAdmin.done_check_element_logic||(e instanceof y&&e.length&&(t=e.closest(".builder-wrapper").index(),w[t])&&w[t].section&&(e=y.tmEPOAdmin.find_index(w[t].section.is_slider,e)),void 0===t&&void 0!==e)||(void 0===e?(n=w,r=!0):(n=[],t=y.epoAPI.math.toFloat(t),e=y.epoAPI.math.toFloat(e),n[t]=y.extend(!0,{},w[t]),l=n[t].fields[e],n[t].fields=[],n[t].fields[e]=l),Object.keys(n).forEach(function(i){a=n[i].fields,Object.keys(a).forEach(function(e){var t;l=a[e],o=y.tmEPOAdmin.getFieldValue(l,"element_type"),t=y.tmEPOAdmin.getFieldValue(l,"uniqid",o),(r&&-1!==d.indexOf(t)||!t||""===t||void 0===t||!1===t)&&y.tmEPOAdmin.setFieldValue(i,e,"uniqid",y.epoAPI.math.uniqueid("",!0),o),r&&d.push(y.tmEPOAdmin.getFieldValue(w[i].fields[e],"uniqid",o))})}),y.tmEPOAdmin.done_check_element_logic=!0)},sectionLogicStart:function(e){var t,i;void 0===e?t=w:(t=[],e=y.epoAPI.math.toFloat(e),t[e]=y.extend(!0,{},w[e])),Object.keys(t).forEach(function(e){y.tmEPOAdmin.section_logic_init(e);try{i=t[e].section.sections_logicrules.default||"null",i=y.epoAPI.util.parseJSON(i),i=y.tmEPOAdmin.logic_check_section_rules(i),w[e].section.sections_logicrules.default=b.stringify(i),w[e].section.rules_toggle=i.toggle}catch(e){}})},elementLogicStart:function(e,t){var i,n,a,l,o,d;void 0===e?a=w:(a=[],t=y.epoAPI.math.toFloat(t),e=y.epoAPI.math.toFloat(e),a[t]=y.extend(!0,{},w[t]),o=a[t].fields[e],a[t].fields=[],a[t].fields[e]=o),Object.keys(a).forEach(function(t){void 0!==(l=a[t].fields)&&Object.keys(l).forEach(function(e){o=l[e],y.tmEPOAdmin.element_logic_init(e,t);try{d=y.tmEPOAdmin.getFieldValue(o,"element_type"),n=y.tmEPOAdmin.getFieldValue(o,"logic",d)||"null",i=y.tmEPOAdmin.getFieldValue(o,"logicrules",d)||"null",i=y.epoAPI.util.parseJSON(i),n&&"null"!==n&&(i=y.tmEPOAdmin.logic_check_element_rules(i,t,e)),y.tmEPOAdmin.setFieldValue(t,e,"logicrules",b.stringify(i),d)}catch(e){}})})},panelsReorder:function(e){y(e).children(".options-wrap").each(function(e,t){y(t).find(".tm-default-radio,.tm-default-checkbox").val(e)})},panelsSortable:function(e){0!==y(e).length&&y.tmEPOAdmin.is_original&&e.sortablejs({handle:".move",fallbackClass:"sortable-fallback",onStart:function(e){y.tmEPOAdmin.panelsReorder(y(e.item).closest(".panels_wrap"))}})},builder_panel_delete_all_onClick:function(e){var t=y(this).closest(".onerow").find(".tcpagination"),i=y(".flasho.tc-wrapper").find(".panels_wrap");e.preventDefault(),y(this).trigger("hideTtooltip"),t.tcPagination("destroy"),1<i.children().length&&((e=i.find(".options-wrap")).each(function(e){if(0===e)return!0;y(this).remove(),i.find(".numorder").each(function(e){y(this).html(parseInt(e,10)+1)})}),e.find("input").val(""),y.tmEPOAdmin.panelsReorder(i))},builder_image_delete_onClick:function(e){var t=y(this);e.preventDefault(),t.trigger("hideTtooltip"),t.closest(".tc-upload-image-wrap").removeClass("has-image").find("input.tm_option_image").val("").removeClass("has-image"),t.closest(".tm_upload_image").find("img").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")},builder_panel_delete_onClick:function(e){var t=y(this).closest(".panels_wrap");e.preventDefault(),y(this).trigger("hideTtooltip"),1<t.children().length&&y(this).closest(".options-wrap").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){y(this).remove(),t.find(".numorder").each(function(e){y(this).html(parseInt(e,10)+1)}),t.children(".options-wrap").each(function(t){y(this).find("[id]").each(function(){var e=y(this).attr("name").replace(/[[\]]/g,"");y(this).attr("id",e+"_"+t)})}),y.tmEPOAdmin.panelsReorder(t)})},builder_panel_mass_add_onClick:function(e){var t=y(this);e.preventDefault(),t.is(".disabled")||(t.addClass("disabled"),e='<div class="tm-panel-populate-wrapper"><textarea class="tm-panel-populate"></textarea><button type="button" class="tc tc-button builder-panel-populate">'+x.i18n_populate+"</button></div>",t.after(e))},builder_panel_populate_onClick:function(e){var i=y(".flasho.tc-wrapper").find(".panels_wrap"),n=i.children(),a=y(""),t=y(".tm-panel-populate").val().split(/\n/),l=[];e.preventDefault(),y(this).remove(),t.forEach(function(e){/\S/.test(e)&&l.push(y.epoAPI.util.trim(e))}),l.forEach(function(e){var e=e.split("|"),t=e.length;0!==t&&(1===t&&(e[1]=""),e[0]=y.epoAPI.util.trim(e[0]),void 0!==e[1]&&""!==e[1]?e[1]=parseFloat(y.epoAPI.util.trim(e[1])):e[1]="",Number.isFinite(e[1])||(e[1]=""),t=y.tmEPOAdmin.add_panel_row(e,i,n),a=a.add(t))}),a.length&&(i.append(a),a.find(".tc-option-enabled").prop("checked",!0).val("1").trigger("changechoice"),a.find(".tc-cell-dnmpbq .c").trigger("changednmpbq"),a.find(".tc-cell-fee .c").trigger("changefee"),y.tcToolTip(a.find(".tm-tooltip"))),y(".builder-panel-mass-add").removeClass("disabled"),y(".tm-panel-populate-wrapper").remove(),y.tmEPOAdmin.paginattion_init("last"),y.tmEPOAdmin.floatbox_content_js()},add_panel_row:function(e,t,i){var n=i.last().tcClone();return n?(y.tmEPOAdmin.builder_clone_elements_after_events(n),n.find("[name]").val(""),n.find(".tm_option_title").val(e[0]),n.find(".tm_option_value").val(y("<div/>").html(e[0]).text()),n.find(".tm_option_price").val(e[1]),e[2]&&(n.find(".tm_option_price_type").val(e[2]),!1===n.find(".tm_option_price_type").val())&&n.find(".tm_option_price_type").val(""),e[3]&&(n.find(".tm_option_description").val(e[3]),!1===n.find(".tm_option_description").val())&&n.find(".tm_option_description").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),n):y("")},builder_panel_add_separator_onClick:function(e){var t=y(this).prevUntil(".panels_wrap").prev(),i=t.children(),n=i.last().tcClone();e.preventDefault(),n&&(n.addClass("separator"),n.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").addClass("tm-hidden"),n.find("[name]").val(""),n.find(".tc-cell-value input").removeClass("tm_option_value").val("-1"),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),y.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=y(e)).val(e.data("builder").tags.value),e.is(".tc-option-enabled")&&e.prop("checked",!0).trigger("changechoice")}),y.tcToolTip(n.find(".tm-tooltip")),y.tmEPOAdmin.paginattion_init("last"),y.tmEPOAdmin.floatbox_content_js())},builder_panel_add_onClick:function(e){var t=y(this).prevUntil(".panels_wrap").prev(),i=t.children().not(".separator"),n=i.last().tcClone();e.preventDefault(),n&&(n.find("[name]").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),y.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=y(e)).val(e.data("builder").tags.value),e.is(".tc-option-enabled")&&e.prop("checked",!0).trigger("changechoice")}),y.tcToolTip(n.find(".tm-tooltip")),y.tmEPOAdmin.paginattion_init("last"),y.tmEPOAdmin.floatbox_content_js())},builder_add_section_onClick:function(e,t,i){var n,a,l=y.epoAPI.template.html(h.tc_builder_section,{});return e&&e.preventDefault(),!(!l||!(e=y(l)))&&(e.addClass("w100"),e.find(".tm-builder-sections-uniqid").val(y.epoAPI.math.uniqueid("",!0)),n=y.tmEPOAdmin.getFieldObject(e),a={},Object.keys(n).forEach(function(e){a[n[e].id]=n[e]}),l={fields:[],section:a,size:y.tmEPOAdmin.builderSize[a.sections_size.default],sections_internal_name:a.sections_internal_name.default},e.find(".section_elements").empty(),t?(e.appendTo(".builder-layout"),w.push(l)):0<y(".builder-layout .tma-variations-wrap").length?(y(".builder-layout .tma-variations-wrap").after(e),w.splice(1,0,l)):(e.prependTo(".builder-layout"),w.unshift(l)),y.tmEPOAdmin.check_section_logic(e),y.tmEPOAdmin.section_logic_init(e),i||(y.tmEPOAdmin.builder_items_sortable(e.find(".bitem-wrapper")),y.tmEPOAdmin.builder_reorder_multiple(),y(this).is("a")&&y(d).tcScrollTo(e)),y.tmEPOAdmin.initSectionsCheck(),y.tmEPOAdmin.makeResizables(e),e)},builder_add_element_onClick:function(e){var n=y(this),t=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_add_element}),a=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-element",cancelEvent:function(e){e.destroy(),y("body").removeClass("floatbox-open")},cancelClass:".floatbox-cancel",data:t});e&&e.preventDefault(),y(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=y(this).attr("data-element");e.preventDefault(),n.is(".tc-prepend")?y.tmEPOAdmin.builder_clone_element(i,t,"prepend"):y.tmEPOAdmin.builder_clone_element(i,t),y.tmEPOAdmin.logic_reindex(),a.destroy(),y("body").removeClass("floatbox-open")}),y("body").addClass("floatbox-open")},builder_add_section_and_element_onClick:function(e){var t=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_add_element}),i=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",cancelEvent:function(e){e.destroy(),y("body").removeClass("floatbox-open")},cancelClass:".floatbox-cancel",data:t});e&&e.preventDefault(),y(".tc-builder-add-section-and-element .tc-element-button").on("click.cpf",function(e){var t=y.tmEPOAdmin.builder_add_section_onClick(!1,!0);e.preventDefault(),t&&(e=y(this).attr("data-element"),y.tmEPOAdmin.builder_clone_element(e,t),y.tmEPOAdmin.logic_reindex(),i.destroy()),y("body").removeClass("floatbox-open")}),y("body").addClass("floatbox-open")},tm_variations_check:function(){var e,i;y(".builder-layout .element-variations").length&&1===y.tmEPOAdmin.variationsCheckForChanges&&l&&(y("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_variations_check",post_id:l.post_id,security:l.check_attributes_nonce},y.post(l.ajax_url,e,function(e){w[0].variations_html=e.html,y(".tma-variations-wrap .tm-all-attributes").html(e.html),e.jsobject&&(w[0].jsobject=e.jsobject,w[0].fields[0].find(function(e,t){return"multiple"===e.id&&(i=t),"multiple"===e.id}),void 0!==i?w[0].fields[0][i]=e.jsobject:w[0].fields[0].push(e.jsobject)),y("#tc-admin-extra-product-options").unblock(),y("#tc-admin-extra-product-options").trigger("woocommerce_tm_variations_check_loaded"),y.tmEPOAdmin.variationsCheckForChanges=0,y.tmEPOAdmin.builder_reorder_multiple()},"json"))},builder_variation_delete_onClick:function(){y.tmEPOAdmin.var_is("tm-style-variation-forced",!0),y(".builder_add_section").addClass("inline"),y(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),1<y(".tma-variations-wrap").length&&y(".tma-variations-wrap").not(":first").each(function(){var e=y(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck()}),y(".tma-variations-wrap").addClass("tm-hidden"),y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),y.tmEPOAdmin.initSectionsCheck()},builder_add_variation_onClick:function(e){e&&e.preventDefault(),!0===y.tmEPOAdmin.var_is("tm-style-variation-added")?!0===y.tmEPOAdmin.var_is("tm-style-variation-forced")&&(y.tmEPOAdmin.var_is("tm-style-variation-forced",!1),y(".builder_add_variation").addClass("tm-hidden"),y(".builder_add_section").removeClass("inline"),y(".tma-variations-wrap").find(".section-setting.clone,.section-setting.size,.section-setting.move,.section-setting.plus,.section-setting.minus").remove(),y(".tma-variations-wrap").removeClass("tm-hidden"),y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),y.tmEPOAdmin.initSectionsCheck()):(e=y.tmEPOAdmin.builder_add_section_onClick(!1,!1,!0))&&(e.find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),e.addClass("tma-nomove tma-variations-wrap"),y.tmEPOAdmin.var_is("tm-style-variation-added",!0),e=y.tmEPOAdmin.builder_clone_element("variations",y(".builder-layout").find(".builder-wrapper").first()),y.tmEPOAdmin.setVariationSection(),!0===y.tmEPOAdmin.var_is("tm-style-variation-forced")?(y(".builder_add_section").addClass("inline"),y(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),y(".tma-variations-wrap").addClass("tm-hidden"),y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled","1")):(y(".builder_add_variation").addClass("tm-hidden"),y(".builder_add_section").removeClass("inline"),y(".tma-variations-wrap").removeClass("tm-hidden"),y.tmEPOAdmin.var_is("tm-style-variation-forced",!1),y.tmEPOAdmin.setFieldValue(y.tmEPOAdmin.variationSectionIndex,y.tmEPOAdmin.variationFieldIndex,"variations_disabled","")),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.bitem-settings .minus,.tm-label-actions").remove(),e.addClass("tma-nomove"),e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),y.tmEPOAdmin.pre_element_logic_init_set(),y.tmEPOAdmin.logic_reindex_force(),y.tmEPOAdmin.variationsCheckForChanges=1,y.tmEPOAdmin.tm_variations_check())},var_is:function(e,t){if(!t)return y("body").data(e);y("body").data(e,t)},var_remove:function(e){e&&y("body").removeData(e)},tm_escape:function(e){return encodeURIComponent(e)},tm_unescape:function(e){return decodeURIComponent(e)},get_element_logic_init:function(e){return y.tmEPOAdmin.pre_element_logic_init_done||y.tmEPOAdmin.pre_element_logic_init(e),y.tmEPOAdmin.isinit?y.tmEPOAdmin.pre_element_logic_init_done=!0:y.tmEPOAdmin.pre_element_logic_init_done=!1,y.tmEPOAdmin.pre_element_logic_init_obj},get_element_logic_options_init:function(e){return y.tmEPOAdmin.pre_element_logic_init_done||y.tmEPOAdmin.pre_element_logic_init(e),y.tmEPOAdmin.isinit?y.tmEPOAdmin.pre_element_logic_init_done=!0:y.tmEPOAdmin.pre_element_logic_init_done=!1,y.tmEPOAdmin.pre_element_logic_init_obj_options},find_index:function(e,t,i,n){var a=0;return e&&(a=t.closest(".bitem-wrapper").prevAll(".bitem-wrapper").find(".bitem"),a=(a=n?a.not(n):a).length),i&&n?(e=t.parent().find(i).not(n),-1!==(e=parseInt(e.index(t),10))?parseInt(a,10)+e:e):parseInt(a,10)+parseInt(t.index(),10)},setGlobalVariationObject:function(t,i){var e,n;l?(y("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_get_variations_array",post_id:l.post_id,security:l.check_attributes_nonce},n=d.ajaxurl||l.ajax_url,y.post(n,e,function(e){e&&(C=e,!0===t?y.tmEPOAdmin.pre_element_logic_init_set(i):"reindex"===t?y.tmEPOAdmin.logic_reindex_force():"initialitize_on"===t?y.tmEPOAdmin.initialitize_on():"initialitize_on_after"===t&&y.tmEPOAdmin.initialitize_on_after())},"json").always(function(){y("#tc-admin-extra-product-options").unblock()})):"initialitize_on"===t?(C=C||{},y.tmEPOAdmin.initialitize_on()):"initialitize_on_after"===t&&(C=C||{},y.tmEPOAdmin.initialitize_on_after())},pre_element_logic_init:function(e){C?y.tmEPOAdmin.pre_element_logic_init_set(e):y.tmEPOAdmin.setGlobalVariationObject(!0,e)},getFieldValue:function(e,t,i){if((i&&!0!==i||!0===i&&(i=y.tmEPOAdmin.getFieldValue(e,"element_type")))&&(t=i+"_"+t),void 0!==(i=e.find(function(e){return e.id===t}))&&"object"==typeof i)return i.default},getFieldMultiple:function(e,t,i){var n,a;if(t="options_"+t,t="multiple_"+(t=i&&!0!==i||!0===i&&(i=y.tmEPOAdmin.getFieldValue(e,"element_type"))?i+"_"+t:t),e.find(function(e,t){return"multiple"===e.id&&(n=t),"multiple"===e.id}),void 0!==n&&(a=e[n].multiple.map(function(e){return e.find(function(e){return e.id===t})}).filter(function(e){return null!=e}))&&"object"==typeof a)return a},setFieldValue:function(e,t,i,n,a){var l;(a&&!0!==a||!0===a&&(a=y.tmEPOAdmin.getFieldValue(w[e].fields[t],"element_type")))&&(i=a+"_"+i),a=w[e].fields[t],Array.isArray(a)&&a.find(function(e,t){return e.id===i&&(l=t),e.id===i}),void 0!==l?(w[e].fields[t][l].default=n,void 0!==w[e].fields[t][l].checked&&void 0!==w[e].fields[t][l].tags&&(w[e].fields[t][l].checked=n===w[e].fields[t][l].tags.value)):w[e].fields[t].push({id:i,default:n,type:"input",tags:{value:"1",name:"tm_meta[tmfbuilder]["+i+"][]",id:"tm_metatmfbuilder"+i}})},setFieldValueMultiple:function(e,t,i,n,a){var l,o;i.toString.isNumeric()?o=i:(i="options_"+i,i="multiple_"+(i=a&&!0!==a||!0===a&&(a=y.tmEPOAdmin.getFieldValue(w[e].fields[t],"element_type"))?a+"_"+i:i)),w[e].fields[t].find(function(e,t){return"multiple"===e.id&&(l=t),"multiple"===e.id}),void 0!==l&&(a=w[e].fields[t][l].multiple,void 0===o?a.find(function(e,t){return e.id===i&&(o=t),e.id===i}):w[e].fields[t][l].multiple[o].default=n)},setVariationSection:function(){w.find(function(e,t){var i,n;return void 0!==(n=void 0!==e&&void 0!==e.fields?e.fields.find(function(e,t){e=e.find(function(e){return"element_type"===e.id&&"variations"===e.default});return void 0!==e&&(i=t),e}):n)&&(y.tmEPOAdmin.variationSectionIndex=t,y.tmEPOAdmin.variationFieldIndex=i,y.tmEPOAdmin.variationSection=w[y.tmEPOAdmin.variationSectionIndex].fields[y.tmEPOAdmin.variationFieldIndex],w[y.tmEPOAdmin.variationSectionIndex].section.tma_variations_wrap=!0),void 0!==n})},pre_element_logic_init_set:function(t){var i,n,a,l,o,d,r,s,c,m,u,p,f,_,h,b,g,v,A,O,E,P;C&&(y.tmEPOAdmin.pre_element_logic_init_obj={},y.tmEPOAdmin.pre_element_logic_init_obj_options={},n={},a=[],(i={productgroup_start:[]}).productgroup_start[0]='<optgroup label="Product properties">',i[l="product-properties"]=[],r=[],u=x.i18n_quantity,i[l][1]='<option data-type="'+"quantity"+'" data-section="'+l+'" value="0">'+u+"</option>",r[0]='<input data-element="0" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',u=x.i18n_product_id,i[l][2]='<option data-type="'+"productid"+'" data-section="'+l+'" value="1">'+u+"</option>",r[1]='<input data-element="1" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',u=x.i18n_variations,i[l][3]='<option data-type="'+"variation"+'" data-section="'+l+'" value="2">'+u+"</option>",r[2]='<input data-element="2" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',u=x.i18n_variation_attribute,i[l][4]='<option data-type="'+"variationattributes"+'" data-section="'+l+'" value="3">'+u+"</option>",r[3]=x.productAttributes.replace("%field_index%",3).replace("%section_id%",l),n[l]={values:r},i.productgroup_end=[],i.productgroup_end[0]="</optgroup>",y.tmEPOAdmin.setVariationSection(),i.addons_start=[],i.addons_start[0]='<optgroup label="Addons">',Object.keys(w).forEach(function(e){void 0!==(O=w[e].section)&&(l=O.sections_uniqid.default,-1!==a.indexOf(l)&&(w[e].section.sections_uniqid.default=y.epoAPI.math.uniqueid("",!0),l=w[e].section.sections_uniqid.default),a.push(l),i[l]=[],t&&y.tmEPOAdmin.check_section_logic(e),v=O.sections_internal_name.default||"Section",O.tma_variations_wrap||(i[l][0]='<option data-type="section" data-section="'+l+'" value="'+l+'">'+v+" ("+l+")</option>"),o=w[e].fields.filter(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return"variations"===t||-1!==y.inArray(t,y.tmEPOAdmin.canTakeLogic)&&"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",t)}),d=w[e].fields.filter(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===y.tmEPOAdmin.getFieldValue(e,"enabled",t)}),r=[],s=[],Object.keys(o).forEach(function(e){if(E=o[e],A=y.tmEPOAdmin.getFieldValue(E,"element_type"),c=y.tmEPOAdmin.getFieldValue(E,"header_title",A),P=y.tmEPOAdmin.getFieldValue(E,"uniqid",A),m=d.findIndex(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return P===y.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&("variations"===t||-1!==y.inArray(t,y.tmEPOAdmin.canTakeLogic)&&"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",!0))}),p=y.tmEPOAdmin.getFieldValue(E,"enabled",A),f="1"===y.tmEPOAdmin.getFieldValue(E,"enabled",A),p&&!f)return!0;void 0!==c&&(void 0!==(u=c)&&0!==u.length||(u=""),(p=y.tmEPOAdmin.getFieldValue(E,"internal_name",A))!==u&&(u=u+" ("+p+")"),f="variations"===A?"variation":-1!==y.inArray(A,["radiobuttons","checkboxes","product","selectbox","selectboxmultiple"])?"multiple":"text",i[l][m+1]='<option data-type="'+f+'" data-section="'+l+'" value="'+m+'">'+u+"</option>","variations"===A?(s=[],y(C.variations).each(function(e,t){var i="publish"===(i=t.status||"invalid")?"":" ("+i+")";_=[],y(t.attributes).each(function(e,t){t=y.map(t,function(e){return e});y(t).each(function(e,t){_.push(t)})}),_=_.join(" - "),h=_;try{h=y.tmEPOAdmin.tm_unescape(_)}catch(e){h=_}s.push('<option value="'+y.tmEPOAdmin.tm_escape(t.variation_id)+'">'+h+i+"</option>")}),r[m]='<select data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value">'+s.join("")+"</select>"):-1!==y.inArray(A,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(b=y.tmEPOAdmin.getFieldMultiple(E,"title",A),g=y.tmEPOAdmin.getFieldMultiple(E,"value",A),s=[],Object.keys(b).forEach(function(e){s.push('<option value="'+y.tmEPOAdmin.tm_escape(g[e].default)+'">'+b[e].default+"</option>")}),r[m]='<select data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value">'+s.join("")+"</select>"):r[m]='<input data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value" type="text" value="">')}),n[l]={values:r})}),i.addons_end=[],i.addons_end[0]="</optgroup>",y.tmEPOAdmin.pre_element_logic_init_obj=n,y.tmEPOAdmin.pre_element_logic_init_obj_options=i)},element_logic_init:function(e,t,i){var n,a,l,o,d,r,s=[],c=[],m={};e instanceof y&&(t=e.closest(".builder-wrapper").index(),e=y.tmEPOAdmin.find_index(w[t].section.is_slider,e)),t=y.epoAPI.math.toFloat(t),e=y.epoAPI.math.toFloat(e),r=y.tmEPOAdmin.getFieldValue(w[t].fields[e],"uniqid",!0),l=w[t].fields.filter(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===y.tmEPOAdmin.getFieldValue(e,"enabled",t)}),n=l.findIndex(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return r===y.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&-1!==y.inArray(t,y.tmEPOAdmin.canTakeLogic)&&"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",!0)}),y.tmEPOAdmin.check_section_logic(),y.tmEPOAdmin.check_element_logic(e,t),l=y.extend(!0,{},y.tmEPOAdmin.get_element_logic_init()),m=y.extend(!0,{},l),d=y.extend(!0,{},y.tmEPOAdmin.get_element_logic_options_init()),o=y.extend(!0,{},y.tmEPOAdmin.get_element_logic_options_init()),(a=w[t].section.sections_uniqid.default)&&l[a]&&l[a].values[n]?(m[a]={values:m[a].values},m[a].values.forEach(function(e,t){n!==t&&delete m[a].values[t]}),delete l[a].values[n],delete d[a][n+1],delete d[a][0]):a&&d[a]&&d[a][0]&&delete d[a][0],y.each(d,function(e,t){t&&y.each(t,function(e,t){t&&c.push(t)})}),y.each(o,function(e,t){e===a&&y.each(t,function(e,t){e===n+1&&s.push(t)})}),y.tmEPOAdmin.elementLogicObject.init||(y.tmEPOAdmin.elementLogicObject.init=!0),y.tmEPOAdmin.elementLogicObject=y.extend(y.tmEPOAdmin.elementLogicObject,l),y.tmEPOAdmin.elementShippingLogicObject.init||(y.tmEPOAdmin.elementShippingLogicObject.init=!0),y.tmEPOAdmin.elementShippingLogicObject=y.extend(y.tmEPOAdmin.elementShippingLogicObject,m),i&&(y.tmEPOAdmin.logic_append(i,c,"element",t,e),y.tmEPOAdmin.shipping_logic_append(i,s,"element",t,e,"enable"),y.tmEPOAdmin.shipping_logic_append(i,s,"element",t,e,"disable"))},section_logic_init:function(e,t){var i,n,a,l=[],o={};e instanceof y?e=parseInt(e.index(),10):void 0!==e&&(e=y.epoAPI.math.toFloat(e)),void 0===e?a=w:(a=[])[e]=y.extend(!0,{},w[e]),y.tmEPOAdmin.check_section_logic(e),Object.keys(a).forEach(function(e){void 0!==w[e].section&&(o=y.extend(!0,{},y.tmEPOAdmin.get_element_logic_init(!0)),i=y.extend(!0,{},y.tmEPOAdmin.get_element_logic_options_init(!0)),(n=w[e].section.sections_uniqid.default)&&o[n]&&(delete o[n],delete i[n]),y.each(i,function(e,t){t&&y.each(t,function(e,t){t&&l.push(t)})}),y.tmEPOAdmin.sectionLogicObject.init||(y.tmEPOAdmin.sectionLogicObject.init=!0),y.tmEPOAdmin.sectionLogicObject=y.extend(y.tmEPOAdmin.sectionLogicObject,o),t)&&y.tmEPOAdmin.logic_append(t,l,"section",e)})},logic_check_section_rules:function(e){var n,a;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=y.tmEPOAdmin.convert_rules(e),n=y.epoAPI.util.deepCopyArray(e),a=y.tmEPOAdmin.sectionLogicObject,y.each(e.rules,function(i,e){Array.isArray(e)&&(y.each(e,function(e,t){void 0!==a[t.section]&&void 0!==a[t.section].values[t.element]||t.section===t.element||delete n.rules[i][e]}),0===n.rules[i].length&&delete n.rules[i],n.rules[i]=O(n.rules[i]))}),n.rules=O(n.rules),n},logic_check_element_rules:function(e,t,n){var a,l,o=!1;return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=y.tmEPOAdmin.convert_rules(e),a=y.epoAPI.util.deepCopyArray(e),l=y.tmEPOAdmin.elementLogicObject,y.each(e.rules,function(i,e){Array.isArray(e)&&(y.each(e,function(e,t){void 0!==l[t.section]&&void 0!==l[t.section].values[t.element]||t.section===t.element||(delete a.rules[i][e],o=!0)}),0===a.rules[i].length?delete a.rules[i]:a.rules[i]=O(a.rules[i])),o&&void 0!==t&&void 0!==n&&y(".builder-layout").find(".builder-wrapper").eq(t).find(".bitem").eq(n).addClass("tm-wrong-rule")}),a.rules=O(a.rules),a},shipping_logic_check_element_rules:function(e){return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e},convert_rules:function(e){return e.what&&("all"===e.what?e.rules=[e.rules]:"any"===e.what&&(e.rules=e.rules.reduce(function(e,t){return e.push([t]),e},[])),delete e.what),e},shipping_logic_append:function(e,t,i,n,a,l){var o,d,r,s,c,m,u,p;if(e=y(e),e=y(e).find(".tm-shipping-"+l+"-logicrules + .shipping-logic-div .tm-logic-wrapper"),!t||1!==t.length)return e.html('<div class="errortitle">'+x.i18n_cannot_apply_shippingrules+"</div>"),!1;try{c=y.tmEPOAdmin.getFieldValue(w[n].fields[a],"shipping_methods_"+l+"_logicrules",!0)||"null",o=y.epoAPI.util.parseJSON(c),p=y.tmEPOAdmin.shipping_logic_check_element_rules(o),y.tmEPOAdmin.setFieldValue(n,a,"shipping_methods_"+l+"_logicrules",b.stringify(p),!0)}catch(e){p=!1}e.empty(),d='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',s=y('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),c=y('<select class="cpf-logic-element">'+t.join("")+"</select>"),m="",Object.keys(y.tmEPOAdmin.logicOperators).forEach(function(e){m=m+'<option value="'+e+'">'+y.tmEPOAdmin.logicOperators[e]+"</option>"}),m=y('<select class="cpf-logic-operator">'+m+"</select>"),s.find(".tm-logic-element").append(c),s.find(".tm-logic-operator").append(m),p&&void 0!==p.rules&&p.rules.length?(u=y('<div class="temp" />'),y.each(p.rules,function(e,t){r=y(d),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?y.each(t,function(e,t){r.find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule(t,s,i,!0))}):r.find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule({},s,i,!0))),u.append(r))}),u=u.children(),e.append(u).removeClass("tc-hidden")):(u=y('<div class="temp" />'),(r=y(d)).find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule({},s,i,!0)),u.append(r),u=u.children(),e.append(u),u.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),u.find(".cpf-logic-operator").val(u.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]),e.addClass("tc-hidden"))},logic_append:function(e,t,i,n,a){var l,o,d,r,s,c,m,u;if(e=y(e),e=y(e).find(".builder-logic-div .tm-logic-wrapper"),!t||0===t.length)return e.html('<div class="errortitle">'+x.i18n_cannot_apply_rules+"</div>"),!1;try{s="1"===("element"===i?y.tmEPOAdmin.getFieldValue(w[n].fields[a],"logic",!0)||"":w[n].section.sections_logic.default||"")?"element"===i?y.tmEPOAdmin.getFieldValue(w[n].fields[a],"logicrules",!0)||"null":w[n].section.sections_logicrules.default||"null":"null",l=y.epoAPI.util.parseJSON(s),u="element"===i?y.tmEPOAdmin.logic_check_element_rules(l):y.tmEPOAdmin.logic_check_section_rules(l),"element"===i?y.tmEPOAdmin.setFieldValue(n,a,"logicrules",b.stringify(u),!0):w[n].section.sections_logicrules.default=b.stringify(u)}catch(e){u=!1}e.empty(),o='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',r=y('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),s=y('<select class="cpf-logic-element">'+t.join("")+"</select>"),c="",Object.keys(y.tmEPOAdmin.logicOperators).forEach(function(e){c=c+'<option value="'+e+'">'+y.tmEPOAdmin.logicOperators[e]+"</option>"}),c=y('<select class="cpf-logic-operator">'+c+"</select>"),r.find(".tm-logic-element").append(s),r.find(".tm-logic-operator").append(c),u&&void 0!==u.rules&&u.rules.length?(u=y.tmEPOAdmin.convert_rules(u),m=y('<div class="temp" />'),y.each(u.rules,function(e,t){d=y(o),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?y.each(t,function(e,t){d.find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule(t,r,i))}):d.find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule({},r,i))),m.append(d))}),m=m.children(),e.append(m)):(m=y('<div class="temp" />'),(d=y(o)).find(".tm-logic-rule-wrap").append(y.tmEPOAdmin.logic_append_rule({},r,i)),m.append(d),m=m.children(),e.append(m),m.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),m.find(".cpf-logic-operator").val(m.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]))},logic_append_rule:function(e,t,i,n){var t=t.clone(),a=t.find(".cpf-logic-element").find('option[data-section="'+e.section+'"][value="'+e.element+'"]');return y(a).length&&(y(a)[0].selected=!0),y.tmEPOAdmin.cpf_logic_element_onchange(t.find(".cpf-logic-element"),n?2:"element"===i),t.find(".cpf-logic-operator").val(e.operator),y.tmEPOAdmin.cpf_logic_operator_onchange(t.find(".cpf-logic-operator"),"element"===i),void 0===e.value&&(e.value=""),t.find(".cpf-logic-value").is("select")?t.find(".cpf-logic-value").val(y.tmEPOAdmin.tm_escape(y.tmEPOAdmin.tm_unescape(e.value))):t.find(".cpf-logic-value").val(y.tmEPOAdmin.tm_unescape(e.value)),t},logic_get_JSON:function(e,t,i){var n,a,l,o,e=y(e).find(".builder-logic-div"),d={},r=e.find(".epo-rule-toggle").val();return d[t]=i,d.toggle=r,d.rules=[],e.find(".tm-logic-wrapper").children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=y(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=y(t),a=t.find(".cpf-logic-element"),n=a.find("option:selected").attr("data-section"),a=a.val(),l=t.find(".cpf-logic-operator").val(),void 0===(o=t.find(".cpf-logic-value").val())&&(o=""),t.find(".cpf-logic-value").is("select")||(o=y.tmEPOAdmin.tm_escape(o)),i.push({section:n,element:a,operator:l,value:o})}),d.rules.push(i)}),b.stringify(d)},shipping_logic_get_JSON:function(e,t,i,n){var a,l,o,d,e=y(e).find(".tm-shipping-"+n+"-logicrules + .shipping-logic-div"),r={},n=e.find(".tm-logic-wrapper");return n.is(".tc-hidden")?"":(r[t]=i,r.toggle="show",r.rules=[],n.children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=y(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=y(t),l=t.find(".cpf-logic-element"),a=l.find("option:selected").attr("data-section"),l=l.val(),o=t.find(".cpf-logic-operator").val(),void 0===(d=t.find(".cpf-logic-value").val())&&(d=""),t.find(".cpf-logic-value").is("select")||(d=y.tmEPOAdmin.tm_escape(d)),i.push({section:a,element:l,operator:o,value:d})}),r.rules.push(i)}),b.stringify(r))},section_logic_get_JSON:function(e){var t,i="";return e.find(".activate-sections-logic").is(":checked")&&(t=e.find(".tm-builder-sections-uniqid").val(),i=y.tmEPOAdmin.logic_get_JSON(e,"section",t)),i},element_logic_get_JSON:function(e){var t,i="";return e.find(".activate-element-logic").is(":checked")&&(t=e.find(".tm-builder-element-uniqid").val(),i=y.tmEPOAdmin.logic_get_JSON(e,"element",t)),i},element_shipping_logic_get_JSON:function(e,t){var i=e.find(".tm-builder-element-uniqid").val();return y.tmEPOAdmin.shipping_logic_get_JSON(e,"element",i,t)},cpf_add_rule:function(e){var t=y(this).closest(".tm-logic-rule"),i=t.tcClone(!0);e.preventDefault(),i&&t.after(i)},cpf_add_rule_set:function(e){var t=y(this).closest(".builder-logic-div, .shipping-logic-div").find(".tm-logic-wrapper"),i=t.find(".tm-logic-rule-set:last()");e.preventDefault(),t.is(".tc-hidden")?t.removeClass("tc-hidden"):(e=i.tcClone(!0))&&(e.find(".tm-logic-rule:not(:first)").remove(),i.after(e),e.find(".tm-logic-rule:first .cpf-logic-element").prop("selectedIndex",0).trigger("change.cpf"))},cpf_delete_rule:function(e){var t=y(this),i=t.closest(".tm-logic-wrapper"),n=t.closest(".tm-logic-rule-set"),a=1<i.children(".tm-logic-rule-set").length,l=n.find(".tm-logic-rule-wrap").children(".tm-logic-rule").length;e.preventDefault(),t.trigger("hideTtooltip"),1<l||a?t.closest(".tm-logic-rule").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){(a&&1===l?n:y(this)).remove()}):i.addClass("tc-hidden")},section_logic_reindex:function(){var o=y.tmEPOAdmin.builderItemsSortableObj;Object.keys(w).forEach(function(n){var a,e=n,l=[],t=w[n].section.sections_logicrules.default||"null";return!w[n].section.sections_logic.default||!((t=y.epoAPI.util.parseJSON(t))&&void 0!==t.rules&&0<t.rules.length)||(t=y.tmEPOAdmin.convert_rules(t),o.end.section_eq===e?y.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],y.each(e,function(e,t){a=y.epoAPI.util.deepCopyArray(t),t.element>o.start.element&&t.section===o.start.section&&(a.element=parseInt(a.element,10)-1),l[i][e]=y.tmEPOAdmin.validate_rule(a,n)}),l[i]=O(l[i]))}):y.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],y.each(e,function(e,t){a=y.epoAPI.util.deepCopyArray(t),"check"!==o.start.section&&(t.section===o.start.section&&t.section===o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&parseInt(t.element,10)<=parseInt(o.end.element,10)?a.element=parseInt(a.element,10)-1:parseInt(t.element,10)<parseInt(o.start.element,10)&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1):t.section===o.start.section&&t.section!==o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&a.section!==a.element&&(a.element=parseInt(a.element,10)-1):t.section!==o.start.section&&t.section===o.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1)),"delete"===o.end.section&&"delete"===a.element||(l[i][e]=y.tmEPOAdmin.validate_rule(a,n))}),l[i]=O(l[i]))}),0===(l=O(l)).length&&(w[n].section.sections_logic.default=""),t.rules=l,void(w[n].section.sections_logicrules.default=b.stringify(t)))})},element_logic_reindex:function(){var i,n,a=y.tmEPOAdmin.builderItemsSortableObj,e=a.start.disabledFieldIndex;e&&(a.start.element=e.toString()),(e=a.end.disabledFieldIndex)&&(a.end.element=e.toString()),Object.keys(w).forEach(function(t){Object.keys(w[t].fields).forEach(function(e){i=w[t].fields[e],n=y.tmEPOAdmin.getFieldValue(i,"element_type"),y.tmEPOAdmin.do_element_logic_reindex(i,n,t,e,a),y.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"enable"),y.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"disable")})})},do_element_logic_reindex:function(e,t,n,a,l){var o,d;return!(y.tmEPOAdmin.getFieldValue(e,"logic",t)&&(o=[],e=y.tmEPOAdmin.getFieldValue(e,"logicrules",t),e=y.epoAPI.util.parseJSON(e),e=y.tmEPOAdmin.convert_rules(e))&&void 0!==e.rules&&0<e.rules.length)||(y.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],y.each(e,function(e,t){if(d=y.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==l.start.section&&(t.section===l.start.section&&t.section===l.end.section?t.element===l.start.element?d.element=l.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(l.start.element,10)&&parseInt(t.element,10)<=parseInt(l.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(l.start.element,10)&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===l.start.section&&t.section!==l.end.section?t.element===l.start.element?(d.section=l.end.section,d.element=l.end.element):t.section!==t.element&&!y.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(l.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==l.start.section&&t.section===l.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===l.end.section&&"delete"===d.element||(y.tmEPOAdmin.builderItemsSortableObj.end.novalidate&&"delete"===y.tmEPOAdmin.builderItemsSortableObj.end.novalidate?o[i][e]=d:o[i][e]=y.tmEPOAdmin.validate_rule(d,n,a))}),0===o[i].length?delete o[i]:o[i]=O(o[i]))}),0===(o=O(o)).length&&y.tmEPOAdmin.setFieldValue(n,a,"logic","",t),e.rules=o,void y.tmEPOAdmin.setFieldValue(n,a,"logicrules",b.stringify(e),t))},do_element_shipping_logic_reindex:function(e,t,i,n,a,l){var o,d,l="shipping_methods_"+l+"_logicrules",e=y.tmEPOAdmin.getFieldValue(e,l,t);return!(e&&(o=[],e=y.epoAPI.util.parseJSON(e))&&void 0!==e.rules&&0<e.rules.length)||(y.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],y.each(e,function(e,t){if(d=y.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==a.start.section&&(t.section===a.start.section&&t.section===a.end.section?t.element===a.start.element?d.element=a.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(a.start.element,10)&&parseInt(t.element,10)<=parseInt(a.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(a.start.element,10)&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===a.start.section&&t.section!==a.end.section?t.element===a.start.element?(d.section=a.end.section,d.element=a.end.element):t.section!==t.element&&!y.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(a.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==a.start.section&&t.section===a.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===a.end.section&&"delete"===d.element||(o[i][e]=d)}),0===o[i].length?delete o[i]:o[i]=O(o[i]))}),void(0===(o=O(o)).length?y.tmEPOAdmin.setFieldValue(i,n,l,"",t):(e.rules=o,y.tmEPOAdmin.setFieldValue(i,n,l,b.stringify(e),t))))},validate_rule:function(i,e,t){var n,a,l,o,d;return!C||!i||"object"!=typeof i||void 0===i.element||void 0===i.operator||void 0===i.section||void 0===i.value&&"isempty"!==i.operator&&"isnotempty"!==i.operator?[]:(o=y(".builder-layout").find(".builder-wrapper").eq(e),void 0!==t&&(o=o.find(".bitem").eq(t)),"product-properties"===i.section?(o.removeClass("tm-wrong-rule"),i):-1!==(n=w.findIndex(function(e){return e.section.sections_uniqid.default===i.section}))&&(void 0!==(n=w[n].fields.filter(function(e){var t=y.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===y.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===y.tmEPOAdmin.getFieldValue(e,"enabled",t)})[i.element])?(d=y.tmEPOAdmin.getFieldValue(n,"element_type"),a=!1,-1!==y.inArray(d,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(l=y.tmEPOAdmin.getFieldMultiple(n,"value",d),Object.keys(l).some(function(e,t){return y.tmEPOAdmin.tm_escape(l[t].default)===i.value?a=!0:l[t].default===i.value&&(i.value=y.tmEPOAdmin.tm_escape(i.value),a=!0),a})):"variations"===d&&("is"===i.operator||"isnot"===i.operator)?y(C.variations).each(function(e,t){if(y.tmEPOAdmin.tm_escape(t.variation_id)===i.value)return!(a=!0)}):a=!0):a=!0,0<o.length)?a||void 0!==t&&""===y.tmEPOAdmin.getFieldValue(w[e].fields[t],"logic",d)?(o.removeClass("tm-wrong-rule"),i):(o.addClass("tm-wrong-rule"),[]):[])},logic_check_rules_reindex:function(l,e,o,t,d,r,s){var c;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=y.tmEPOAdmin.convert_rules(e),c=y.epoAPI.util.deepCopyArray(e),o=parseInt(o,10),t=parseInt(t,10),r=parseInt(r,10),s=parseInt(s,10),y.each(e.rules,function(i,e){var n,a;Array.isArray(e)&&(y.each(e,function(e,t){n=t.section,a=t.element,n===d&&a.toString().isNumeric()&&(a=parseInt(a,10),o===a?s&&0===r?(delete c.rules[i][e],l.addClass("tm-wrong-rule")):1===r&&(a+=1,c.rules[i][e].element=a.toString()):o<a&&(0===r?(--a,c.rules[i][e].element=a.toString()):1===r&&(a+=1,c.rules[i][e].element=a.toString())))}),0===c.rules[i].length?delete c.rules[i]:c.rules[i]=O(c.rules[i]))}),c.rules=O(c.rules),c},logic_reindex:function(){var e=y.tmEPOAdmin.builderItemsSortableObj;e.start.section===e.end.section&&e.start.section_eq===e.end.section_eq&&e.start.element===e.end.element||(y.tmEPOAdmin.section_logic_reindex(),y.tmEPOAdmin.element_logic_reindex()),y.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},logic_reindex_force:function(){y.tmEPOAdmin.builderItemsSortableObj.start.section="check",y.tmEPOAdmin.builderItemsSortableObj.start.section_eq="check",y.tmEPOAdmin.builderItemsSortableObj.start.element="check",y.tmEPOAdmin.builderItemsSortableObj.end.section="check2",y.tmEPOAdmin.builderItemsSortableObj.end.section_eq="check2",y.tmEPOAdmin.builderItemsSortableObj.end.element="check2",y.tmEPOAdmin.section_logic_reindex(),y.tmEPOAdmin.element_logic_reindex(),y.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},builder_items_sortable:function(e){y.tmEPOAdmin.is_original&&(e=e.filter(function(){return!y(this).closest(".tma-nomove").length})).not(".tma-nomove").sortablejs({handle:".move",draggable:".bitem",onStart:function(e){var t,i,n,a,e=y(e.item);y.tmEPOAdmin.isElementDragged=!0,(t=e.closest(".builder-wrapper")).addClass("has-drag"),t.closest(".builder-layout").addClass("has-drag"),a=t.index(),i=w[a].section.is_slider,n=y.tmEPOAdmin.find_index(i,e),e=y.tmEPOAdmin.find_index(i,e,".bitem",".element-is-disabled"),w[a].section.sections.default=parseInt(w[a].section.sections.default,10)-1,w[a].section.sections.default=w[a].section.sections.default.toString(),i&&(w[a].section.sections_slides.default=t.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".sortable-ghost").length}).get().join(",")),y.tmEPOAdmin.builderItemsSortableObj.start.section=w[a].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.start.section_eq=a.toString(),y.tmEPOAdmin.builderItemsSortableObj.start.element=n.toString(),y.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=e,y(".builder-layout .bitem-wrapper").not(".tma-variations-wrap .bitem-wrapper").addClass("highlight")},onEnd:function(e){var t,i,n,a,l,e=y(e.item);y.tmEPOAdmin.isElementDragged=!1,t=e.closest(".builder-wrapper"),y(".builder-wrapper").removeClass("has-drag"),t.closest(".builder-layout").removeClass("has-drag"),l=t.index(),i=w[l].section.is_slider,n=y.tmEPOAdmin.find_index(i,e),a=y.tmEPOAdmin.find_index(i,e),e=y.tmEPOAdmin.find_index(i,e,".bitem",".element-is-disabled"),y(".builder-wrapper.tm-zindex").css("zIndex","").removeClass("tm-zindex"),w[l].section.sections.default=parseInt(w[l].section.sections.default,10)+1,w[l].section.sections.default=w[l].section.sections.default.toString(),i&&(w[l].section.sections_slides.default=t.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".sortable-ghost").length}).get().join(",")),y.tmEPOAdmin.builderItemsSortableObj.end.section=w[l].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),y.tmEPOAdmin.builderItemsSortableObj.end.element=a.toString(),y.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=e,w[l].fields.splice(n,0,w[y.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(y.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.logic_reindex(),y(".builder-layout .bitem-wrapper").removeClass("highlight")},fallbackClass:"sortable-fallback",filter:".panels_wrap",group:"bitem",animation:100})},builder_delete_do:function(){var e,t,i=y.tmEPOAdmin.currentElement,n=y(this);if(Array.isArray(i))for(t=i.length-1;0<=t;t--)e=i[t],y.tmEPOAdmin.builder_delete_do_single.apply(e);else y.tmEPOAdmin.builder_delete_do_single.apply(n);y.tmEPOAdmin.after_actions_menu()},builder_delete_do_single:function(){var e,t,i,n,a,l,o,d,r=y(this);y.tmEPOAdmin.copyElement&&y.tmEPOAdmin.copyElement[0]===r.closest(".bitem")[0]&&(y.tmEPOAdmin.copyElement=null),r.closest(".builder-layout").is(".builder-template")?y.tmEPOAdmin.builder_section_delete_do.apply(this):(l=(e=r.closest(".builder-wrapper")).index(),t=r.closest(".bitem"),i=w[l].section.is_slider,n=y.tmEPOAdmin.find_index(i,t),a=y.tmEPOAdmin.find_index(i,t,".bitem",".element-is-disabled"),w[l].section.sections.default=parseInt(w[l].section.sections.default,10)-1,w[l].section.sections.default=w[l].section.sections.default.toString(),d=w[l].fields[n],o=y.tmEPOAdmin.getFieldValue(d,"element_type"),d=void 0===y.tmEPOAdmin.getFieldValue(d,"enabled",o)||"1"===y.tmEPOAdmin.getFieldValue(d,"enabled",o),y.tmEPOAdmin.builderItemsSortableObj.start.section=w[l].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),y.tmEPOAdmin.builderItemsSortableObj.start.element=a.toString(),y.tmEPOAdmin.builderItemsSortableObj.end.section="delete",y.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",y.tmEPOAdmin.builderItemsSortableObj.end.element="delete",d||(y.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,y.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=y.tmEPOAdmin.find_index(i,r,".bitem",".element-is-disabled")),t.remove(),w[l].fields.splice(n,1),y.tmEPOAdmin.logic_reindex(),i&&(w[l].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(",")),y.tmEPOAdmin.builder_reorder_multiple())},builder_delete_onClick:function(e,t){t=t||this;e.preventDefault(),y.tmEPOAdmin.doConfirm(x.i18n_builder_delete,y.tmEPOAdmin.builder_delete_do,t)},builder_copy_element:function(){var e,t,i,n=y.tmEPOAdmin.currentElement,a=y.tmEPOAdmin.currentMenuElement;if(a&&Array.isArray(n)){for(a.is(".bitem")||(a=a.closest(".bitem")),e=(t=n.length)-1;0<=e;e--)if(n[e][0]===a[0]){i=!0;break}i||(n=y.tmEPOAdmin.currentMenuElement)}if(y(".is-copy").removeClass("is-copy"),Array.isArray(n))for(t=n.length,e=0;e<t;e++)n[e].addClass("is-copy");else(n=n.is(".bitem")?n:n.closest(".bitem")).addClass("is-copy");y.tmEPOAdmin.copyElement=n},builder_paste_element:function(){var e,t,i,n,a,l,o,d,r,s,c,m,u,p,f,_,h,b=y.tmEPOAdmin.currentElement,g=y.tmEPOAdmin.currentElement,v=y.tmEPOAdmin.copyElement,A=y.tmEPOAdmin.copyElement;if(y.tmEPOAdmin.copyElement)if(g&&!Array.isArray(g)&&g.is(".builder-add-element")){for(e=g.closest(".builder-wrapper"),n=(i=(v=Array.isArray(v)?v:[v]).length)-1;0<=n;n--)t=g.is(".tc-prepend")?y.tmEPOAdmin.builder_clone_element("header",e,"prepend"):y.tmEPOAdmin.builder_clone_element("header",e),y.tmEPOAdmin.logic_reindex(),t&&(p=v[n].closest(".builder-wrapper").index(),f=w[p].section.is_slider,_=y.tmEPOAdmin.find_index(f,v[n]),d=e.index(),s=w[d].section.is_slider,r=y.tmEPOAdmin.find_index(s,t),y.tmEPOAdmin.copyElement=v[n],y.tmEPOAdmin.currentElement=t,b=y.tmEPOAdmin.currentElement,y.tmEPOAdmin.builder_clone_do.apply(b,[b]),y.tmEPOAdmin.builder_delete_do.apply(b),h=y.tmEPOAdmin.getFieldValue(w[d].fields[r],"uniqid",l),w[d].fields[r]=y.epoAPI.util.deepCopyArray(w[p].fields[_]),a=w[d].fields[r],l=y.tmEPOAdmin.getFieldValue(a,"element_type"),y.tmEPOAdmin.setFieldValue(d,r,"uniqid",h,l),w[d].section.sections_repeater.default)&&-1!==y.inArray(l,y.tmEPOAdmin.cannotTakeSectionRepeater)&&(c=y.tmEPOAdmin.getFieldValue(a,"enabled",l),m="",o=e.find(".bitem").eq(r),u=y.tmEPOAdmin.getFieldValue(a,"logic",l),y.tmEPOAdmin.setFieldValue(d,r,"enabled",m,l),y.tmEPOAdmin.setFieldValue(d,r,"shadow_enabled",c,l),c!==m)&&(o.addClass("element-is-disabled"),y.tmEPOAdmin.after_element_enabled_change(m,u,d,r,o,s));y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null,y.tmEPOAdmin.copyElement=A}else{if(b&&Array.isArray(b)){for(n=(i=b.length)-1;0<n;n--)y.tmEPOAdmin.builder_delete_do_single.apply(b[n]);b=b[0],y.tmEPOAdmin.currentElement=b}if((b=b.is(".bitem")?b:b.closest(".bitem")).is(".bitem")){if(i=(v=Array.isArray(v)?v:[v]).length,y.tmEPOAdmin.copyElement)for(n=i-1;0<=n;n--)if(v[n][0]===b[0])return;for(n=i-1;0<=n;n--)p=v[n].closest(".builder-wrapper").index(),f=w[p].section.is_slider,_=y.tmEPOAdmin.find_index(f,v[n]),d=(e=b.closest(".builder-wrapper")).index(),s=w[d].section.is_slider,y.tmEPOAdmin.copyElement=v[n],y.tmEPOAdmin.currentElement=b,y.tmEPOAdmin.builder_clone_do.apply(b,[b]),r=y.tmEPOAdmin.find_index(s,b)+1,h=y.tmEPOAdmin.getFieldValue(w[d].fields[r],"uniqid",l),w[d].fields[r]=y.epoAPI.util.deepCopyArray(w[p].fields[_]),a=w[d].fields[r],l=y.tmEPOAdmin.getFieldValue(a,"element_type"),y.tmEPOAdmin.setFieldValue(d,r,"uniqid",h,l),w[d].section.sections_repeater.default&&-1!==y.inArray(l,y.tmEPOAdmin.cannotTakeSectionRepeater)&&(c=y.tmEPOAdmin.getFieldValue(a,"enabled",l),m="",o=e.find(".bitem").eq(r),u=y.tmEPOAdmin.getFieldValue(a,"logic",l),y.tmEPOAdmin.setFieldValue(d,r,"enabled",m,l),y.tmEPOAdmin.setFieldValue(d,r,"shadow_enabled",c,l),c!==m)&&(o.addClass("element-is-disabled"),y.tmEPOAdmin.after_element_enabled_change(m,u,d,r,o,s));y.tmEPOAdmin.builder_delete_do.apply(b),y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null,y.tmEPOAdmin.copyElement=A}}},builder_actions_menu_onClick:function(e){var t=y(this).attr("data-action"),i=y.tmEPOAdmin.currentElement;switch(Array.isArray(i)&&(i=y.tmEPOAdmin.currentMenuElement),y.tmEPOAdmin.noMouseDownCheck=!0,y.tmEPOAdmin.closeContextMenu(!0),t){case"copy":y.tmEPOAdmin.builder_copy_element(e),y.tmEPOAdmin.after_actions_menu();break;case"paste":y.tmEPOAdmin.builder_paste_element(e),y.tmEPOAdmin.after_actions_menu();break;case"clone":y.tmEPOAdmin.builder_clone_onClick(e,i);break;case"delete":y.tmEPOAdmin.builder_delete_onClick(e,i);break;case"edit":y.tmEPOAdmin.builder_item_onClick(e,i),y.tmEPOAdmin.after_actions_menu();break;case"change":y.tmEPOAdmin.builder_change_onClick(e,i);break;default:y.tmEPOAdmin.after_actions_menu()}},after_actions_menu:function(){y.tmEPOAdmin.noMouseDownCheck&&(y.tmEPOAdmin.noMouseDownCheck=null,y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null)},builder_actions_onClick:function(e){var t,i,n,a,l,o,d=y(this),r=y.tmEPOAdmin.copyElement,s=y.tmEPOAdmin.currentElement;if(e.preventDefault(),e.stopPropagation(),d.is(".menu-active"))y.tmEPOAdmin.closeContextMenu(void 0,!0);else{if(y(".tc-actions-menu").remove(),y(".menu-active").removeClass("menu-active"),i=y(y.epoAPI.template.html(p.template("tc-actions-menu"),{})).appendTo("body"),d.addClass("menu-active"),t=d.offset(),l=d.is(".bitem")?(n=e.pageX+"px",a=e.pageY+"px",Array.isArray(y.tmEPOAdmin.currentElement)?y.tmEPOAdmin.currentMenuElement=d.find(".actions"):y.tmEPOAdmin.currentElement=d.find(".actions"),d):(n=t.left-i.outerWidth()+d.outerWidth()+"px",a=t.top+d.outerHeight()+"px",Array.isArray(y.tmEPOAdmin.currentElement)?y.tmEPOAdmin.currentMenuElement=d:y.tmEPOAdmin.currentElement=d,d.closest(".bitem")),y.tmEPOAdmin.copyElement&&l[0]!==y.tmEPOAdmin.copyElement[0]||i.find('[data-action="paste"]').addClass("disabled"),v||i.find('[data-action="paste"], [data-action="copy"], [data-action="clone"]').remove(),Array.isArray(s))for(o=s.length-1;0<=o&&s[o][0]!==l[0];o--);if(Array.isArray(r))for(o=r.length-1;0<=o;o--)if(r[o][0]===l[0]){i.find('[data-action="edit"], [data-action="paste"], [data-action="change"]').addClass("disabled");break}i.addClass("menu-active tm-animated fadein").css({left:n,top:a}),y.tmEPOAdmin.contextMenuOpen=!0}},builder_add_element_onContextmenu:function(e){var t,i,n=y(this);e.preventDefault(),e.stopPropagation(),n.is(".menu-active")?y.tmEPOAdmin.closeContextMenu(void 0,!0):(y(".tc-actions-menu").remove(),y(".menu-active").removeClass("menu-active"),(e=y(y.epoAPI.template.html(p.template("tc-actions-menu"),{})).appendTo("body")).find('.context-menu-item:not([data-action="paste"])').remove(),n.addClass("menu-active"),t=(i=n.offset()).left-e.outerWidth()+n.outerWidth()+"px",i=i.top+n.outerHeight()+"px",y.tmEPOAdmin.currentElement=n,y.tmEPOAdmin.copyElement||e.find('[data-action="paste"]').addClass("disabled"),e.addClass("menu-active tm-animated fadein").css({left:t,top:i}),y.tmEPOAdmin.contextMenuOpen=!0)},builder_fold_onClick:function(){var e=y(this),t=(e=e.is(".tma-handle")?e.find(".fold"):e).closest(".tma-handle-wrap").find(".tma-handle-wrapper").first();e.data("folded")||void 0===e.data("folded")?(e.data("folded",!1),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down"),t.removeClass("tm-hidden")):(e.data("folded",!0),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"),t.addClass("tm-hidden"))},builder_section_fold_onClick:function(){var e=y(this),t=e.closest(".builder-wrapper");e.data("folded")?(e.data("folded",!1),t.removeClass("tm-hide-bitems"),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down")):(e.data("folded",!0),t.addClass("tm-hide-bitems"),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"))},builder_section_delete_do:function(){var e=y(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.section_logic_init(),y.tmEPOAdmin.initSectionsCheck()},builder_section_delete_onClick:function(e){e.preventDefault(),y(this).trigger("blur"),y.tmEPOAdmin.doConfirm(x.i18n_builder_delete,y.tmEPOAdmin.builder_section_delete_do,this)},builder_plus_onClick:function(){var e=y(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(y.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n+1],n=y.tmEPOAdmin.builderSize[i];void 0!==i&&(e.css("--flex-width",n.replace("%","")),e.attr("data-size",n.replace("%","")),e.removeClass("flex-reset "+String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=y.tmEPOAdmin.find_index(w[n].section.is_slider,e),y.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_minus_onClick:function(){var e=y(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(y.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n-1],n=y.tmEPOAdmin.builderSize[i];void 0!==i&&(e.css("--flex-width",n.replace("%","")),e.attr("data-size",n.replace("%","")),e.removeClass("flex-reset "+String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=y.tmEPOAdmin.find_index(w[n].section.is_slider,e),y.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_section_plus_onClick:function(){var e,t=y(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(y.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a+1],a=y.tmEPOAdmin.builderSize[n];void 0!==n&&(t.css("--flex-width",a.replace("%","")),t.attr("data-size",a.replace("%","")),t.removeClass("flex-reset "+String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),w[e].section.sections_size.default=n,w[e].size=a,y.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_minus_onClick:function(){var e,t=y(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(y.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a-1],a=y.tmEPOAdmin.builderSize[n];void 0!==n&&(t.css("--flex-width",a.replace("%","")),t.attr("data-size",a.replace("%","")),t.removeClass("flex-reset "+String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),w[e].section.sections_size.default=n,w[e].size=a,y.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_item_onClick:function(){var t,i,n,e=y.epoAPI.template.html(h.tc_builder_section,{}),a=y(this).closest(".builder-wrapper"),l=a.index(),e=y(e);e.addClass(w[l].section.sections_size.default),e.addClass("appear"),!0===w[l].section.tma_variations_wrap&&(e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),e.find(".tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce,.tma-tab-repeater").hide()),n=e.find(".section_elements"),y.tmEPOAdmin.copyContent(n,l),y.tmEPOAdmin.check_section_logic(l),t=y.tmEPOAdmin.sectionLogicObject,e=y.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:x.i18n_edit_settings,uniqidtext:x.i18n_section_uniqid+":",uniqid:w[l].section.sections_uniqid.default}),y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"80%",height:"80%",classname:"flasho tc-wrapper edit-section"+(a.is(".tma-variations-wrap")?" tma-variations-section":""),data:e,cancelEvent:function(e){i||(i=!0,y.tmEPOAdmin.sectionLogicObject=t,y.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),y("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){i||(i=!0,y.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),y.tmEPOAdmin.changeBuilder(n,l),w[l].section.sections_logicrules.default=y.tmEPOAdmin.section_logic_get_JSON(n),y.tmEPOAdmin.sections_type_onChange(l),y.tmEPOAdmin.logic_reindex_force(),e.destroy(),y("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),i=!1,y("body").addClass("floatbox-open"),n.appendTo("#tc-floatbox-content").removeClass("closed"),y.tmEPOAdmin.section_logic_init(l,n),setTimeout(function(){var e=n.find(".tm-builder-logicrules").val()||"null";e=y.epoAPI.util.parseJSON(e),e=y.tmEPOAdmin.logic_check_element_rules(e),n.find(".epo-rule-toggle").val(e.toggle)},1),y.tmEPOAdmin.set_fields_logic(n),n.find(".activate-sections-logic").trigger("change"),n.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),n.tmcheckboxes(),y.tmEPOAdmin.builder_clone_after_events(n),y.tcToolTip(y("#tc-floatbox-content").find(".tm-tooltip")),y.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper")},changeBuilder:function(e,t,i){var n,a,l,o=y.tmEPOAdmin.getFieldObject(e);void 0!==i?(n=y.tmEPOAdmin.getFieldValue(w[t].fields[i],"element_type"),a=w[t].fields[i].filter(function(e){return"element_type"===e.id||"div_size"===e.id||e.id===n+"_internal_name"}),w[t].fields[i]=[].concat.apply(a,o)):(a=[w[t].section.sections_internal_name],o=[].concat.apply(a,o),l={},Object.keys(o).forEach(function(e){l[o[e].id]=o[e]}),l.is_slider=w[t].section.is_slider,l.rules_toggle=w[t].section.rules_toggle,w[t].section=l)},copyContent:function(o,e,t){var d,r,s,c=o.find(".panels_wrap"),m=void 0!==t?w[e].fields[t]:w[e].section;Object.keys(m).forEach(function(n){var i,a,l;"object"==typeof m[n]&&("multiple"===m[n].id?Object.keys(m[n].multiple).forEach(function(t){0===(d=o.find(".options-wrap")).eq(t).length&&(d.eq(0).tcClone().removeClass("separator").appendTo(c).find(":input").not("button").val("").prop("checked",!1).find(".tc-option-enabled").prop("checked",!0).val("1").trigger("changechoice changednmpbq changefee"),(d=o.find(".options-wrap")).eq(t).find(".tc-cell-value input").addClass("tm_option_value")),l={title:!1,value:!1},Object.keys(m[n].multiple[t]).forEach(function(e){i=(i=(i=m[n].multiple[t][e].tags.name).replace("[]","")).substring(0,i.lastIndexOf("[")),a=m[n].multiple[t][e].default,(r=o.find(".options-wrap").eq(t).find("[name^='"+i+"']")).attr("data-builder",b.stringify(m[n].multiple[t][e])),r.attr("name",m[n].multiple[t][e].tags.name).attr("data-field-id",m[n].multiple[t][e].id).removeAttr("id").val(a).trigger("change"),void 0!==m[n].multiple[t][e].checked&&("multiple_checkboxes_options_default_value"===m[n].multiple[t][e].id||"multiple_radiobuttons_options_default_value"===m[n].multiple[t][e].id||"multiple_selectbox_options_default_value"===m[n].multiple[t][e].id||"multiple_selectboxmultiple_options_default_value"===m[n].multiple[t][e].id?r.val(t):r.val(m[n].multiple[t][e].tags.value),!0===m[n].multiple[t][e].checked?r.prop("checked",!0):r.prop("checked",!1)),"multiple_checkboxes_title_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_title_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_title_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.title=!0),"multiple_checkboxes_options_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_options_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_options_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.value=!0)}),l.value&&!l.title?((l=d.eq(t)).addClass("separator"),l.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").addClass("tm-hidden"),l.find(".tm_option_value").removeClass("tm_option_value")):((l=d.eq(t)).removeClass("separator"),l.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").removeClass("tm-hidden"),l.find(".tm_option_value").addClass("tm_option_value"))}):(i=m[n].tags.name,a=m[n].default,r=o.find("[name='"+y.epoAPI.util.escapeSelector(i)+"']"),"product"===m[n].fill&&m[n].options&&m[n].options.push&&(m[n].options.forEach(function(e){r.append(y('<option selected="selected" value="'+e.value+'">'+e.text+"</option>"))}),r.attr("data-exclude",x.original_post_id===x.post_id?x.post_id:x.post_id+","+x.original_post_id)),"category"===m[n].fill&&a&&a.push&&a.forEach(function(e){r.find('option[value="'+e+'"]').attr("selected","selected")}),r.is(".product-default-value-search")&&("products"===o.find(".product-mode:checked").val()||"product"===o.find(".product-mode:checked").val()?(r.removeClass("wc-product-search").addClass("enhanced-dropdown"),s=o.find(".product-products-selector").find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id"),r.find("option").remove(),r.append(s)):""!==a&&(s=m[n].current_selected_text||a,r.attr("data-current-selected",a),r.data("current-selected-text",s),r.append(y('<option selected="selected" value="'+a+'">'+s+"</option>")),r.addClass("wc-product-search")),""!==a)&&r.attr("data-current-selected",a),r.attr("data-builder",b.stringify(m[n])).attr("data-field-id",m[n].id),r.is(":radio")?r.toArray().forEach(function(e,t){var i=m[n].options?(r.eq(t).val(m[n].options[t].value),m[n].options[t].value):r.eq(t).val();i===a?(r.eq(t).prop("checked",!0),r.eq(t).trigger("change")):r.eq(t).prop("checked",!1)}):(r.val(a).trigger("change"),void 0!==m[n].checked&&(r.val(m[n].tags.value),!0===m[n].checked?r.prop("checked",!0):r.prop("checked",!1))),m[n].disabled&&(r.addClass("tm-wmpl-disabled").prop("disabled",!0),r.closest(".message0x0").addClass("tc-setting-disabled"))))})},builder_uniqid_onClick:function(e){var t=y(this);e.ctrlKey&&(t.trigger("blur"),y.tmEPOAdmin.doConfirm({title:x.i18n_builder_change_uniqueid_title,html:x.i18n_builder_change_uniqueid+'<br><input type="text" class="t change-uniqueid" value="'+y(".tm-element-uniqid").attr("data-uniqid")+'" >',update:x.i18n_update,cancel:x.i18n_cancel},y.tmEPOAdmin.builder_uniqid_do,this,[y(this)],!0,!0))},builder_uniqid_do:function(){var e,t,i,n=y(".change-uniqueid").val();n&&(e=y(".tm-builder-element-uniqid"),t=y(".tm-element-uniqid"),i=e.data("builder"),e.val(n),i.default=n,e.attr("data-builder",b.stringify(i)),t.html(x.i18n_element_uniqid+": "+n),t.attr("data-uniqid",n))},builder_item_onClick:function(e,t){var i,n,a,l,o=y(t||this).closest(".bitem"),t=y.epoAPI.template.html(h.tc_builder_elements,{}),d=o.closest(".builder-wrapper").index(),r=w[d].section.sections_repeater.default,s=w[d].section.is_slider,c=y.tmEPOAdmin.find_index(s,o),m=y.tmEPOAdmin.getFieldValue(w[d].fields[c],"element_type"),t=y(t).filter(".bitem.element-"+m).tcClone(!0),u=y.tmEPOAdmin.getFieldValue(w[d].fields[c],"enabled",m);u="variations"===m||"1"===u||void 0===u?"1":"0",!0===w[d].section.tma_variations_wrap&&t.find("tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce,.tma-tab-repeater").remove(),r&&t.find(".tma-tab-repeater").remove(),l=t.find(".builder-element-wrap:first"),"variations"===m&&l.find(".tm-all-attributes").html(w[d].variations_html),y.tmEPOAdmin.copyContent(l,d,c),y.tmEPOAdmin.check_element_logic(c,d),i=y.tmEPOAdmin.elementLogicObject,r=y.tmEPOAdmin.getFieldValue(w[d].fields[c],"uniqid",m),t=y.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:x.i18n_edit_settings,uniqidtext:"variations"===m||void 0===r?"":x.i18n_element_uniqid+": ",uniqid:"variations"===m||void 0===r?"":r}),y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"80%",height:"80%",classname:"flasho tc-wrapper edit-element"+("variations"===m?" tma-variations-section":""),data:t,cancelEvent:function(e){n||(n=!0,(a=l.find(".tcpagination")).data("tc-pagination")&&a.tcPagination("destroy"),y.tmEPOAdmin.elementLogicObject=i,y.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),y("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){var t,i;n||(n=!0,(a=l.find(".tcpagination")).data("tc-pagination")&&a.tcPagination("destroy"),y.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),y.tmEPOAdmin.changeBuilder(l,d,c),y.tmEPOAdmin.setFieldValue(d,c,"logicrules",y.tmEPOAdmin.element_logic_get_JSON(l),m),y.tmEPOAdmin.setFieldValue(d,c,"shipping_methods_enable_logicrules",y.tmEPOAdmin.element_shipping_logic_get_JSON(l,"enable"),m),y.tmEPOAdmin.setFieldValue(d,c,"shipping_methods_disable_logicrules",y.tmEPOAdmin.element_shipping_logic_get_JSON(l,"disable"),m),y.tmEPOAdmin.set_field_title(o,d,c),t="variations"===m||0===l.find(".is_enabled").length||l.find(".is_enabled").is(":checked")?"1":"0",i=0===l.find(".activate-element-logic").length||l.find(".activate-element-logic").is(":checked")?"1":"0","0"==t?o.addClass("element-is-disabled"):o.removeClass("element-is-disabled"),y.tmEPOAdmin.setFieldValue(d,c,"shadow_enabled","2",m),u!=t&&y.tmEPOAdmin.after_element_enabled_change(t,i,d,c,o,s),y.tmEPOAdmin.logic_reindex_force(),e.destroy(),y("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),n=!1,y("body").addClass("floatbox-open"),l.appendTo("#tc-floatbox-content"),y("#tc-floatbox-content").find(".builder-element-wrap").addClass("tm-hidden").after(y('<div class="floatbox-loading">'+x.i18n_loading+"</div>")),setTimeout(function(){var e;y.tmEPOAdmin.element_logic_init(c,d,l),l.find(".activate-element-logic").trigger("change"),l.find(".tc-option-enabled").trigger("changechoice"),l.find(".tc-cell-dnmpbq .c").trigger("changednmpbq"),l.find(".tc-cell-fee .c").trigger("changefee"),e=l.find(".tm-builder-logicrules").val()||"null",e=y.epoAPI.util.parseJSON(e),e=y.tmEPOAdmin.logic_check_element_rules(e),l.find(".epo-rule-toggle").val(e.toggle),l.find(":radio:checked").not(".panels_wrap :radio").trigger("change"),"variations"===m&&(l.find(".builder-remove-for-variations").remove(),l.find(".builder_hide_for_variation").hide()),l.tmcheckboxes(),y.tmEPOAdmin.builder_clone_after_events(l),"variations"===m?y.tmEPOAdmin.variations_display_as():y.tmEPOAdmin.floatbox_content_js(),y.tmEPOAdmin.set_fields_logic(l),y.tcToolTip(y("#tc-floatbox-content").find(".tm-tooltip")),y.tmEPOAdmin.tm_weekdays(y("#tc-floatbox-content")),y.tmEPOAdmin.tm_months(y("#tc-floatbox-content")),y.tmEPOAdmin.tm_url(),y.tmEPOAdmin.tm_pricetype_selector(),y.tmEPOAdmin.dynamicMode(),y.tmEPOAdmin.tm_option_price_type(),y.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper"),y.tmEPOAdmin.paginattion_init(),y("#tc-floatbox-content").find(".builder-element-wrap").removeClass("tm-hidden"),l.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),y("#tc-floatbox-content").find(".floatbox-loading").remove(),w[d].section.sections_repeater.default&&-1!==y.inArray(m,y.tmEPOAdmin.cannotTakeSectionRepeater)&&(y(".element-cannot-be-enabled").removeClass("tm-hidden"),y(".is_enabled").prop("disabled",!0))},1)},after_element_enabled_change:function(i,n,a,e,t,l){var o,d,r=w[a].section.sections_uniqid.default,s=e,c=y.tmEPOAdmin.find_index(l,t,".bitem",".element-is-disabled");Object.keys(w[a].fields).forEach(function(e){o=y.tmEPOAdmin.getFieldValue(w[a].fields[e],"logicrules",!0)||"null",o=y.epoAPI.util.parseJSON(o),o=y.tmEPOAdmin.logic_check_rules_reindex(t,o,s,c,r,i,n),y.tmEPOAdmin.setFieldValue(a,e,"logicrules",b.stringify(o),!0)}),Object.keys(w).forEach(function(t){(t=parseInt(t,10))!==a&&(d=w[t].section.sections_logicrules.default||"null",d=y.epoAPI.util.parseJSON(d),d=y.tmEPOAdmin.logic_check_rules_reindex(y(".builder-wrapper").eq(t),d,s,c,r,i,n),w[t].section.sections_logicrules.default=b.stringify(d),Object.keys(w[t].fields).forEach(function(e){o=y.tmEPOAdmin.getFieldValue(w[t].fields[e],"logicrules",!0)||"null",o=y.epoAPI.util.parseJSON(o),o=y.tmEPOAdmin.logic_check_rules_reindex(y(".builder-wrapper").eq(t).find(".bitem").eq(e),o,s,c,r,i,n),y.tmEPOAdmin.setFieldValue(t,e,"logicrules",b.stringify(o),!0)}))})},set_fields_logic:function(c){c.find(".message0x0[data-required]").toArray().forEach(function(d){var r,t,s="AND";d=y(d),(r=d.data("required")).relation&&(s=r.relation,delete r.relation),t=function(){var o=!0;Object.keys(r).some(function(e){var t,i,n,a=r[e].operator,l=r[e].value;return(o=(o="OR"===s?!0:o)&&(t=y(e),i="",n=!1,c.find(e).length?(t.is(":checkbox")?t.is(":checked")&&(i=t.val()):i=(t.is(":radio")?c.find(e).filter(":checked"):t).val(),n="object"==typeof l?-1!==y.inArray(i,l):i===l,(n="is"===a?n:!n)?d.removeClass("tm-hidden"):d.addClass("tm-hidden"),n):!!("is"===a&&(""===l||Array.isArray(l)&&l.includes(""))||"isnot"===a&&(""!==l||Array.isArray(l)&&!l.includes("")))||n))||d.addClass("tm-hidden"),"OR"===s&&o})},Object.keys(r).forEach(function(e){c.on("change.required changerequired",e,t)}),t()})},getFieldObject:function(e){var i,n,a,l,o,d,t=[];return e.find(":input").not("button").not(".panels_wrap :input").toArray().forEach(function(e){(e=y(e)).is(":radio")&&!e.is(":checked")||void 0!==(i=e.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:e.val(),type:e.prop("nodeName").toLowerCase(),tags:{name:i}},(e.is(":checkbox")||e.is(":radio"))&&(o.checked=e.is(":checked"),o.tags.value=e.attr("value"),o.checked?o.default=e.attr("value"):o.default=""),e.is(".product-categories-selector")?(o.fill="category",o.options=[]):e.is(".product-products-selector")&&(o.fill="product",o.options=[]),e.attr("data-builder")&&(("product"===(d=y.epoAPI.util.parseJSON(e.attr("data-builder"))).fill||"category"===d.fill||e.is(".product-products-selector")||e.is(".product-categories-selector"))&&(o.options=e.find("option:selected").toArray().map(function(e){return{text:y(e).text(),value:y(e).val()}})),d)&&(o=Object.assign(d,o)),e.attr("data-current-selected")&&(o.current_selected=e.attr("data-current-selected"),o.current_selected_text=e.data("current-selected-text")),t.push(o))}),0<e.find(".panels_wrap :input").not("button").length&&(a=[],e.find(".panels_wrap .options-wrap").each(function(e,t){l=[],y(t).find(":input").not("button").each(function(e,t){t=y(t),void 0!==(i=t.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:t.val(),type:t.prop("nodeName").toLowerCase(),tags:{name:i}},(t.is(":checkbox")||t.is(":radio"))&&(o.checked=t.is(":checked"),o.tags.value=t.attr("value"),o.checked?o.default=t.attr("value"):o.default=""),t.attr("data-builder")&&(d=y.epoAPI.util.parseJSON(t.attr("data-builder")))&&(o=Object.assign(d,o)),l.push(o))}),a.push(l)}),t.push({id:"multiple",multiple:a})),t},builder_clone_element:function(l,e,t,i,n){var a,o,d,r,s,c,m=y.epoAPI.template.html(h.tc_builder_elements,{});if(m)return t=t||"append",e=y(e),m=y(m).filter(".bitem.element-"+l).tcClone(!0),r=e.index(),m&&0<=r?(a=w[r].section.is_slider,"replace"===t&&i&&n?(c=i.find(".tm-for-bitem").attr("data-element"),m.find(".tm-builder-element-uniqid").val(y.tmEPOAdmin.getFieldValue(w[r].fields[y.tmEPOAdmin.find_index(a,i)],"uniqid",c))):m.find(".tm-builder-element-uniqid").val(y.epoAPI.math.uniqueid("",!0)),y(".builder-wrapper").length<=0&&(y.tmEPOAdmin.builder_add_section_onClick(),e=y(".builder-wrapper").first()),s=y.tmEPOAdmin.getFieldObject(m),"replace"===t&&i&&n?i.replaceWith(m):("drag"===t&&(m.addClass("dragged"),e.find(".bitem-wrapper").find(".ditem").replaceWith(m)),"append"===t&&(m.addClass("append"),e.find(".bitem-wrapper").not(".tm-hide").append(m)),"prepend"===t&&(m.addClass("prepend"),e.find(".bitem-wrapper").not(".tm-hide").prepend(m)),w[r].section.sections.default=parseInt(w[r].section.sections.default,10)+1,w[r].section.sections.default=w[r].section.sections.default.toString()),o=y.tmEPOAdmin.find_index(a,m),d=y.tmEPOAdmin.find_index(a,m,".bitem",".element-is-disabled"),"replace"===t&&i&&n?"yes"===n?(i=s.map(function(a){var e={},t=w[r].fields[o].find(function(e){var t="div_size"===e.id||"element_type"===e.id||"multiple"===e.id?e.id:l+e.id.slice(c.length);return"header"===c&&["header_size","header_title","header_title_position","header_title_color","header_subtitle","header_subtitle_color","header_subtitle_position"].includes(e.id)?t=l+"_"+e.id:"header"===l&&t.toString().startsWith(l+"_header")&&(t=e.id.slice(l.length-1)),"element_type"!==a.id&&a.id!==l+"_internal_name"&&t===a.id});return t?(Object.keys(a).forEach(function(n){"id"!==n&&"tags"!==n&&t.hasOwnProperty(n)?"multiple"===n?(e[n]=t[n].map(function(e){return e.map(function(e){var t=e.id.replace("_"+c+"_","_"+l+"_"),i=a[n][0].find(function(e){return e.id===t});return i&&e.tags&&(e.tags.name&&(e.tags.name=e.tags.name.replace("_"+c+"_","_"+l+"_")),e.tags.id&&(e.tags.id=e.tags.id.replace("_"+c+"_","_"+l+"_")),t.endsWith("options_default_value"))&&("radiobuttons"===c&&"checkboxes"===l?(e.type="input",e.tags.name=e.tags.name+"[]"):"checkboxes"===c&&"radiobuttons"===l&&(e.type="radio",e.tags.name=e.tags.name.slice(0,-2))),i?Object.assign({},e,{id:t}):null})}),e[n]=e[n].map(function(e){return e.filter(function(e){return null!==e})})):e[n]=t[n]:e[n]=a[n]}),e):a}),w[r].fields[o]=i,void 0===(n=y.tmEPOAdmin.getFieldValue(w[r].fields[o],"header"===l?"title":"header_title",l))||""===n?m.find(".tm-label").html(x.i18n_no_title):m.find(".tm-label").html(n),n=m.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],m.removeClass(String(n)),(n=i.find(function(e){return"div_size"===e.id}))&&(n=n.default,m.addClass(n),i=String(n).replace("-",".").replace("w",""),m.attr("data-size",i),m.find(".bitem-setting.size").text(i+"%"))):w[r].fields[o]=s:"drag"!==t&&"prepend"!==t&&"append"!==t||(a&&(w[r].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(",")),y.tmEPOAdmin.builderItemsSortableObj.start.section="drag",y.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",y.tmEPOAdmin.builderItemsSortableObj.start.element="drag",y.tmEPOAdmin.builderItemsSortableObj.end.section=w[r].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.end.section_eq=e.index().toString(),y.tmEPOAdmin.builderItemsSortableObj.end.element=d.toString(),w[r].fields.splice(o,0,s)),m.find(".builder-element-wrap").empty(),m.find(".builder_element_type").remove(),m.find(".div_size").remove(),y.tmEPOAdmin.check_element_logic(m),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.makeResizables(m),n=w[r].fields[o],i=y.tmEPOAdmin.getFieldValue(n,"element_type"),w[r].section.sections_repeater.default&&-1!==y.inArray(i,y.tmEPOAdmin.cannotTakeSectionRepeater)&&(t=e.find(".bitem").eq(o),y.tmEPOAdmin.setFieldValue(r,o,"enabled","",i),y.tmEPOAdmin.setFieldValue(r,o,"shadow_enabled","1",i),t.addClass("element-is-disabled"),y.tmEPOAdmin.after_element_enabled_change("","",r,o,t,a)),m):void 0},doConfirm:function(e,t,i,n,a,l){var o="object"==typeof e&&null!==e?e.title:e,d="object"==typeof e&&null!==e&&e.html?'<div class="tm-inner">'+e.html+"</div>":"",o=y.epoAPI.template.html(p.template(e.template||"tc-floatbox"),{id:"tc-floatbox-content",title:o,html:d,uniqid:"",update:"object"==typeof e&&null!==e&&void 0!==e.update?e.update:x.i18n_yes,cancel:"object"==typeof e&&null!==e&&void 0!==e.cancel?e.cancel:x.i18n_no}),r=!1;return y.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",classname:"flasho tc-wrapper"+(d?"":" tc-question"),data:o,cancelEvent:function(e){r||(r=!0,e.destroy(),a&&(n.push("no"),t.apply(i,n)))},cancelClass:".floatbox-cancel",updateEvent:function(e){r||(r=!0,a&&n.push("yes"),l?(t.apply(i,n),e.destroy()):(e.destroy(),t.apply(i,n)))},updateClass:".floatbox-update",isconfirm:!0,unique:!0,ismodal:!0})},builder_clone_do:function(){var e,t,i,n,a,l,o;y.tmEPOAdmin.currentElement?(e=y.tmEPOAdmin.currentElement,Array.isArray(e)&&(e=y.tmEPOAdmin.currentMenuElement)):e=y(this).closest(".bitem"),(e=e.is(".bitem")?e:y(this).closest(".bitem")).is(".bitem")&&(o=e.data("original_title"),(t=(y.tmEPOAdmin.copyElement&&!Array.isArray(y.tmEPOAdmin.copyElement)?y.tmEPOAdmin.copyElement:e).tcClone()).data("original_title",o).removeClass("is-copy"),t&&(e.after(t),l=(o=t.closest(".builder-wrapper")).index(),a=w[l].section.is_slider,i=y.tmEPOAdmin.find_index(a,t),n=y.tmEPOAdmin.find_index(a,t,".bitem",".element-is-disabled"),w[l].section.sections.default=parseInt(w[l].section.sections.default,10)+1,w[l].section.sections.default=w[l].section.sections.default.toString(),a&&(w[l].section.sections_slides.default=o.find(".bitem-wrapper").map(function(e,t){return y(t).children(".bitem").not(".pl2").length}).get().join(",")),a=y.tmEPOAdmin.find_index(e,e),w[l].fields.splice(a,0,y.epoAPI.util.deepCopyArray(w[l].fields[a])),y.tmEPOAdmin.setFieldValue(l,i,"uniqid",y.epoAPI.math.uniqueid("",!0),!0),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.builderItemsSortableObj.start.section="clone",y.tmEPOAdmin.builderItemsSortableObj.start.section_eq="clone",y.tmEPOAdmin.builderItemsSortableObj.start.element="clone",y.tmEPOAdmin.builderItemsSortableObj.end.section=w[l].section.sections_uniqid.default,y.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),y.tmEPOAdmin.builderItemsSortableObj.end.element=n.toString(),y.tmEPOAdmin.logic_reindex(),y.tmEPOAdmin.makeResizables(t)),y.tmEPOAdmin.after_actions_menu())},builder_clone_onClick:function(e,t){t=t||this;e.preventDefault(),y.tmEPOAdmin.doConfirm(x.i18n_builder_clone,y.tmEPOAdmin.builder_clone_do,t,[y(t)])},builder_change_do:function(n,a){var e=y.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_change_element}),l=y.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-element",data:e}),o=n.closest(".bitem"),e=o.find(".tm-for-bitem").attr("data-element");y(".tm-elements-container").find(".element-"+e).closest(".tm-element-button").remove(),y(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=y(this).attr("data-element");e.preventDefault(),y.tmEPOAdmin.builder_clone_element(i,t,"replace",o,a),y.tmEPOAdmin.logic_reindex(),l.destroy(),y(".is-copy").removeClass("is-copy"),y.tmEPOAdmin.copyElement=null,y(".bitem.selected").removeClass("selected"),y.tmEPOAdmin.currentElement=null,y.tmEPOAdmin.currentMenuElement=null,y.tmEPOAdmin.after_actions_menu()})},builder_change_onClick:function(e,t){t=t||this;e.preventDefault(),y.tmEPOAdmin.doConfirm({title:x.i18n_builder_change_ask_title,html:x.i18n_builder_change_ask},y.tmEPOAdmin.builder_change_do,t,[y(t)],!0)},builder_section_clone_do:function(){var i,e,t=y(this).closest(".builder-wrapper"),n=t.tcClone();n&&(e=t.index(),i=[],t.find(".bitem").each(function(e,t){i[e]=y(t).data("original_title")}),t.after(n),t=t.index(),w.splice(e,0,y.epoAPI.util.deepCopyArray(w[e])),w[t].section.sections_uniqid.default=y.epoAPI.math.uniqueid("",!0),n.find(".bitem").each(function(e,t){y(t).data("original_title",i[e])}),w[t].section.is_slider&&y.tmEPOAdmin.createSlider(n),y.tmEPOAdmin.builder_reorder_multiple(),y.tmEPOAdmin.builder_items_sortable(n.find(".bitem-wrapper")),y.tmEPOAdmin.check_section_logic(t),y.tmEPOAdmin.check_element_logic(),y.tmEPOAdmin.section_logic_init(t),y.tmEPOAdmin.makeResizables(n),y.tmEPOAdmin.makeResizables(n.find(".bitem")))},builder_section_clone_onClick:function(e){e.preventDefault(),y.tmEPOAdmin.doConfirm(x.i18n_builder_clone,y.tmEPOAdmin.builder_section_clone_do,this,[y(this)])},builder_floatbox_template:function(e,t){return y.epoAPI.template.html(p.template(t||"tc-floatbox"),{id:e.id,title:e.title,html:e.html,uniqidtext:e.uniqidtext||"",uniqid:e.uniqid,update:e.update||x.i18n_update,cancel:e.cancel||x.i18n_cancel})},builder_floatbox_template_import:function(e){return y.epoAPI.template.html(p.template("tc-floatbox-import"),{id:e.id,title:e.title,html:e.html,cancel:x.i18n_cancel})},nameChange:function(e,t){var i=/\[[0-9]+\]\[\]/g,n=/\[[0-9]+\]/g;return null!==e.match(i)?e=e.replace(i,"["+t+"][]"):null!==e.match(n)&&(e=e.replace(n,"["+t+"]")),e},builder_reorder_multiple:function(){[].concat.apply([],w.map(function(e){return e.fields.map(function(e){return e.map(function(e){return"element_type"===e.id?e.default:null}).filter(function(e){return null!==e})[0]})})).filter(function(e,t,i){return i.indexOf(e)===t}).forEach(function(t){var o=0;w.map(function(e){return e.fields.map(function(e){return e.find(function(e){return"element_type"===e.id&&e.default===t})?e:null})}).forEach(function(e,l){e.forEach(function(e,n){var a;e&&(void 0!==(e=e.find(function(e,t){return"multiple"===e.id&&(a=t),"multiple"===e.id}))&&"object"==typeof e&&(e=e.multiple).forEach(function(e,i){e.forEach(function(e,t){w[l].fields[n][a].multiple[i][t].tags.name=y.tmEPOAdmin.nameChange(w[l].fields[n][a].multiple[i][t].tags.name,o)})}),o+=1)})})})},getEnhancedSelectFormatString:function(){return{language:{errorLoading:function(){return n.i18n_searching},inputTooLong:function(e){e=e.input.length-e.maximum;return 1==e?n.i18n_input_too_long_1:n.i18n_input_too_long_n.replace("%qty%",e)},inputTooShort:function(e){e=e.minimum-e.input.length;return 1==e?n.i18n_input_too_short_1:n.i18n_input_too_short_n.replace("%qty%",e)},loadingMore:function(){return n.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?n.i18n_selection_too_long_1:n.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return n.i18n_no_matches},searching:function(){return n.i18n_searching}}}},create_products_search:function(e){e.find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t,e,i={allowClear:!0,placeholder:y(this).data("placeholder"),dropdownCssClass:"tc-dropdown",minimumInputLength:y(this).data("minimum_input_length")?y(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:n.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:y(this).data("action")||"woocommerce_json_search_products_and_variations",security:n.search_products_nonce,exclude:y(this).data("exclude"),include:y(this).data("include"),limit:y(this).data("limit"),display_stock:y(this).data("display_stock"),tcmode:"builder"}},processResults:function(e){var i=[];return e&&y.each(e,function(e,t){i.push({id:e,text:t})}),{results:i}},cache:!0}},i=y.extend(i,y.tmEPOAdmin.getEnhancedSelectFormatString());y(this).selectWoo(i).addClass("enhanced"),y(this).on("select2:open",function(){var e=y(d).scrollTop();y(d).scrollTop(e+1),y(d).scrollTop(e)}),y(this).data("sortable")?(t=y(this),(e=y(this).next(".select2-container").find("ul.select2-selection__rendered")).sortablejs({fallbackClass:"sortable-fallback",draggable:"li:not(.select2-search__field)",handle:"li:not(.select2-search__field)",onEnd:function(){y(e.find(".select2-selection__choice").get().reverse()).each(function(){var e=y(this).data("data").id,e=t.find('option[value="'+e+'"]')[0];t.prepend(e)})}})):y(this).prop("multiple")&&y(this).on("change",function(){var e=y(this).children();e.sort(function(e,t){e=e.text.toLowerCase(),t=t.text.toLowerCase();return t<e?1:e<t?-1:0}),y(this).html(e)})})},create_categories_search:function(e){e.find(":input.wc-category-search").filter(":not(.enhanced)").each(function(){var e=y.extend({allowClear:!0,placeholder:y(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},y.tmEPOAdmin.getEnhancedSelectFormatString());y(this).selectWoo(e).addClass("enhanced"),y(this).on("select2:open",function(){var e=y(d).scrollTop();y(d).scrollTop(e+1),y(d).scrollTop(e)})})},create_enhanced_dropdown:function(e){e.find(":input.enhanced-dropdown").filter(":not(.enhanced)").each(function(){var e={allowClear:!0,placeholder:y(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},e=y.extend(e,y.tmEPOAdmin.getEnhancedSelectFormatString());y(this).selectWoo(e).addClass("enhanced")})},create_normal_dropdown:function(e){e.find("select").filter(":not(.enhanced, .enhanced-dropdown, .wc-category-search, .wc-product-search)").not(".shipping-logic-div select, .builder-logic-div select, .panels_wrap select, .options-wrap select").each(function(){var e={allowClear:!!y(this).is(".wc-template-search"),minimumResultsForSearch:y(this).is(".wc-template-search")?0:-1,dropdownCssClass:"tc-dropdown"},e=y.extend(e,y.tmEPOAdmin.getEnhancedSelectFormatString());y(this).selectWoo(e).addClass("enhanced")})},builder_clone_elements_after_events:function(e){e.find("input.tm-color-picker").spectrum("destroy"),e.find(".sp-replacer").remove(),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!1,showPalette:!1,preferredFormat:"hex",theme:"epo",showButtons:!0,clickoutFiresChange:!1,chooseText:x.i18n_update,cancelText:x.i18n_cancel,clearText:""})},builder_clone_after_events:function(e){var t=y(".sections_type"),i=y(".activate-element-repeater");y.tmEPOAdmin.builder_clone_elements_after_events(e),y.tmEPOAdmin.panelsSortable(e.find(".panels_wrap")),y.tmEPOAdmin.create_normal_dropdown(e),y.tmEPOAdmin.create_enhanced_dropdown(e),y.tmEPOAdmin.create_products_search(e),y.tmEPOAdmin.create_categories_search(e),y(".sections_type").on("change",function(){y.tmEPOAdmin.sections_type_change(y(this))}),y.tmEPOAdmin.sections_type_change(t),y(".activate-element-repeater").on("change",function(){y.tmEPOAdmin.section_repeater(y(this))}),y.tmEPOAdmin.section_repeater(i)},sections_type_change:function(e){var e=e.val(),t=y(".tma-tab-section-repeater"),i=y(".activate-element-repeater");"popup"===e?(t.addClass("tc-hidden"),i.data("checked-state",i.is(":checked")),i.prop("checked",!1).trigger("change")):(t.removeClass("tc-hidden"),i.data("checked-state")&&i.prop("checked",i.data("checked-state")).trigger("change"))},section_repeater:function(e){var t=y(".sections_type:checked"),i=y('.sections_type[value="popup"]'),n=y('.sections_type[value=""]'),t=t.val();e.is(":checked")?(i.prop("disabled",!0),"popup"===t&&n.prop("checked",!0).trigger("change")):i.prop("disabled",!1)},paginattion_init:function(e){var i,n,t=y("#tc-floatbox-content"),a=t.find(".tcpagination");0===a.length||x.tcAdminNoPagination||(t=t.find(".panels_wrap"),i=t.find(".options-wrap"),n=parseInt(a.attr("data-perpage"),10),t=Math.ceil(i.length/n),a.data("tc-pagination")&&a.tcPagination("destroy"),e="last"===e?t:"current"===e&&a.data("pagination_current")||1,a.data("pagination_current",e),a.tcPagination({totalPages:t,startPage:e,visiblePages:10,onPageClick:function(e,t){y.tmEPOAdmin.paginationOnClick(a,t,n,i)}}))},paginationOnClick:function(e,t,i,n){t=parseInt(t,10),e.data("pagination_current",t),n.addClass("tm-hidden"),n.filter(function(e){return i*(t-1)<=e&&e<=i*t-1}).removeClass("tm-hidden")},addTinyMCE:function(e){var i,a,n,l,o,t="excerpt",d="object"==typeof s&&void 0!==s.mceInit&&t in s.mceInit?s.mceInit[t]:{theme:"modern",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link,unlink",plugins:"fullscreen,image,wordpress,wpeditimage,wplink"},r="object"==typeof s&&void 0!==s.qtInit&&t in s.mceInit?s.qtInit[t]:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,fullscreen"};y(e)&&void 0!==u&&(l=y("#wp-"+t+"-editor-tools").html(),o=y("#wp-"+t+"-editor-tools").attr("class"),y(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(a=y(t).attr("id"))||(y(t).attr("id",y(t).attr("name").replace(/[[\]]/g,"")),a=y(t).attr("id")),a&&(i=y.extend({},d,{selector:"#"+a}),n=y.extend({},r,{id:a}),"object"==typeof s&&(s.mceInit[a]=i,s.qtInit[a]=n),y(t).addClass("wp-editor-area").wrap('<div id="wp-'+a+'-wrap" class="wp-core-ui wp-editor-wrap tmce-active tm_editor_wrap"></div>').before('<div class="'+o+'">'+l+"</div>").wrap('<div class="wp-editor-container"></div>'),y(".tm_editor_wrap").find(".wp-switch-editor").each(function(e,t){var i,n;y(t).attr("id")&&(i=(n=y(t).attr("id")).length,n=n.substring(i-4),y(t).attr("id",a+"-"+n),y(t).attr("data-wp-editor-id",a))}),y(".tm_editor_wrap").find(".insert-media").attr("data-editor",a),u.init(i),c&&m&&(m(n),c._buttonsInit()),y(t).closest(".tm_editor_wrap").find("a.insert-media").data("editor",a).attr("data-editor",a))}))},removeTinyMCE:function(e){var i,n,a,l="";y(e)&&void 0!==u&&y(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(i=y(t).attr("id"))&&u&&u.editors&&(n=y(t).val(),a=void 0!==u&&u.editors[i]&&!u.editors[i].isHidden(),void 0!==u.editors[i]&&(l=u.editors[i].getContent(),u.editors[i].remove()),y(t).closest(".tm_editor_wrap").find(".quicktags-toolbar,.wp-editor-tools").remove(),y(t).unwrap().unwrap(),a?""===l?y(t).val(""):y(t).val(l):y(t).val(n))})},set_field_title:function(e,t,i){var n;0!==e.length&&(n=y.tmEPOAdmin.getFieldValue(w[t].fields[i],"element_type"),void 0===(t=y.tmEPOAdmin.getFieldValue(w[t].fields[i],"header_title","header"!==n))||""===t?e.find(".tm-label").html(x.i18n_no_title):e.find(".tm-label").html(t))},variations_display_as:function(e){var n,a,l,e=e?y(this).is(".tm-changes-product-image")?y(this).closest(".tm-attribute").find(".variations-display-as"):y(this):y("#tc-floatbox-content .variations-display-as");e.each(function(e,t){var i;n=y(t).closest(".tm-attribute"),a=n.find(".tm-term"),l=n.find(".tm-changes-product-image"),"select"===(i=y(t).val())?n.find(".tma-hide-for-select-box").hide().addClass("tc-row-hidden"):n.find(".tma-hide-for-select-box").show().removeClass("tc-row-hidden"),"image"===i||"color"===i||"radiostart"===i||"radioend"===i?n.find(".tma-show-for-swatches").show().removeClass("tc-row-hidden"):n.find(".tma-show-for-swatches").hide().addClass("tc-row-hidden"),a.each(function(e,t){switch(y(t).hide().find(".tma-term-color,.tma-term-image,.tma-term-custom-image").hide(),i){case"select":case"radio":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&y(t).show().find(".tma-term-custom-image").show();break;case"image":case"radiostart":case"radioend":l.children("option[value='images']").prop("disabled",!1).show(),y(t).show().find(".tma-term-image").show(),"custom"===l.val()&&y(t).show().find(".tma-term-custom-image").show();break;case"color":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&y(t).show().find(".tma-term-custom-image").show(),y(t).show().find(".tma-term-color").show()}})}),(e=y("#tc-floatbox-content")).find(".tm_option_image").each(function(){var e=y(this),t=e.closest(".tc-upload-image-wrap");""!==e.val()&&(e.addClass("has-image"),t.addClass("has-image")),t.find(".tm_upload_image_img").attr("src",y(this).val()||g)})},floatbox_content_js:function(){var e,t,i,n=y("#tc-floatbox-content"),a=n.find(".replacement-mode:checked"),l=n.find(".tm-changes-product-image"),o=n.find(".show-tooltip"),d=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.swatch"),r=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.swatch-hover"),s=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.product-image"),c=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.lightbox"),m=n.find(".builder-element-wrap").find(".tc-cell-images"),u=n.find(".builder-element-wrap .panels_wrap").find(".tc-upload-image-wrap.color");d.hide(),r.hide(),s.hide(),c.hide(),m.hide(),u.hide(),"images"!==l.val()||"none"!==a.val()&&"text"!==a.val()||(e=n.find(".tm_option_image").not(".tm_option_imagep"),t=n.find(".tm_option_imagep"),i=n.find(".tm_upload_imagep .tm_upload_image_img"),l.val("custom"),e.each(function(e){t.eq(e).val(y(this).val()),i.attr("src",y(this).val()||g)})),a.length&&"image"===a.val()?l.find("option[value='images']").prop("disabled",!1).show():("images"===l.val()&&l.val(""),l.find("option[value='images']").attr("disabled","disabled").hide()),setTimeout(function(){l.selectWoo("destroy").removeClass("enhanced"),y.tmEPOAdmin.create_normal_dropdown(l.parent()),l.trigger("change.select2")},100),("image"===a.val()||"image"===a.val()&&"images"===l.val())&&(d.show(),r.show(),m.show()),"custom"===l.val()&&(s.show(),m.show()),"image"===a.val()&&y("#tc-floatbox-content .tm-use-lightbox").is(":checked")&&c.show(),"color"===a.val()||"text"===a.val()?("swatch_img"!==o.val()&&"swatch_img_lbl"!==o.val()&&"swatch_img_desc"!==o.val()&&"swatch_img_lbl_desc"!==o.val()||o.val(""),o.find("option[value='swatch_img']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_desc']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl_desc']").attr("disabled","disabled").hide()):(o.find("option[value='swatch_img']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl']").prop("disabled",!1).show(),o.find("option[value='swatch_img_desc']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl_desc']").prop("disabled",!1).show()),setTimeout(function(){o.selectWoo("destroy").removeClass("enhanced"),y.tmEPOAdmin.create_normal_dropdown(o.parent()),o.trigger("change.select2")},100),"color"===a.val()&&(m.show(),u.show()),n.find(".tc-option-image").each(function(e){""!==y(this).val()&&(n.find(".tc-option-image").eq(e).addClass("has-image"),n.find(".tc-option-image").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_image").not(".tm_upload_imagec, .tm_upload_imagep, .tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",y(this).val()||g)}),n.find(".tc-option-imagec").each(function(e){""!==y(this).val()&&(n.find(".tc-option-imagec").eq(e).addClass("has-image"),n.find(".tc-option-imagec").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagec").eq(e).find(".tm_upload_image_img").attr("src",y(this).val()||g)}),n.find(".tc-option-imagep").each(function(e){""!==y(this).val()&&(n.find(".tc-option-imagep").eq(e).addClass("has-image"),n.find(".tc-option-imagep").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",y(this).val()||g)}),n.find(".tc-option-imagel").each(function(e){""!==y(this).val()&&(n.find(".tc-option-imagel").eq(e).addClass("has-image"),n.find(".tc-option-imagel").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",y(this).val()||g)}),"image"!==a.val()&&"color"!==a.val()?n.find(".tc-cell-cbsmel").addClass("tc-hidden"):n.find(".tc-cell-cbsmel").removeClass("tc-hidden")},tm_weekdays:function(e){e=y(e||"body");e.find(".tm-weekdays").each(function(e,t){var i=y(t).val().split(","),t=y(t).next(".tm-weekdays-picker-wrap");y(t).find(".tm-weekday-picker").each(function(e,t){-1!==i.indexOf(y(t).val())?(y(t).attr("checked","checked").prop("checked",!0),y(t).closest(".tm-weekdays-picker").addClass("tm-checked")):(y(t).prop("checked",!1),y(t).closest(".tm-weekdays-picker").removeClass("tm-checked"))})})},tm_weekday_picker:function(){var e=y(this).closest(".tm-weekdays-picker-wrap").prev(".tm-weekdays"),t=y(e).val().split(","),i=t.indexOf(y(this).val());y(this).is(":checked")?-1===i&&t.push(y(this).val()):-1!==i&&t.splice(i,1),t=y.map(t,function(e){return""===e?null:e}),y(e).val(t.join(",")),y.tmEPOAdmin.tm_weekdays(y(e).parent())},tm_months:function(e){e=y(e||"body");e.find(".tm-months").each(function(e,t){var i=y(t).val().split(","),t=y(t).next(".tm-months-picker-wrap");y(t).find(".tm-month-picker").each(function(e,t){-1!==i.indexOf(y(t).val())?(y(t).attr("checked","checked").prop("checked",!0),y(t).closest(".tm-months-picker").addClass("tm-checked")):(y(t).prop("checked",!1),y(t).closest(".tm-months-picker").removeClass("tm-checked"))})})},tm_month_picker:function(){var e=y(this).closest(".tm-months-picker-wrap").prev(".tm-months"),t=y(e).val().split(","),i=t.indexOf(y(this).val());y(this).is(":checked")?-1===i&&t.push(y(this).val()):-1!==i&&t.splice(i,1),t=y.map(t,function(e){return""===e?null:e}),y(e).val(t.join(",")),y.tmEPOAdmin.tm_months(y(e).parent())},tm_pricetype_selector:function(e){var t=y(".tc-element-setting-price, .tc-element-setting-sale-price"),e=y(e?this:"#tc-floatbox-content .tm-pricetype-selector");"math"===e.val()?t.attr("autocomplete","off"):t.removeAttr("autocomplete")},dynamicMode:function(e){var t=y(".tc-element-setting-price"),e=y(e?this:"#tc-floatbox-content .dynamic-mode"),e=e.val();t.removeClass("dynamic-product-price override-product-price change-product-weight"),"dynamic_product_price"===e?t.addClass("dynamic-product-price"):"override_product_price"===e?t.addClass("override-product-price"):"change_product_weight"===e&&t.addClass("change-product-weight")},tm_option_price_type:function(e){e=y(e?this:"#tc-floatbox-content .tm_option_price_type");"math"===e.val()?y(".tm_option_price, .tm_option_sale_price").attr("autocomplete","off"):y(".tm_option_price, .tm_option_sale_price").removeAttr("autocomplete")},tm_url:function(e){var t=y("#tc-floatbox-content"),i=y(this),t=t.find(".builder-element-wrap").find(".tc-cell-url");"url"===(i=e?i:y("#tc-floatbox-content .use_url")).val()?t.show():t.hide()},upload:function(e){var o,d,r,n,t;if(e.preventDefault(),!p||!p.media)return!1;o=y(this).prev("input"),d=y(this).nextAll(".tm_upload_image").first().find("img"),(o.data("tm_upload_frame")?o.data("tm_upload_frame"):(e=p.media.controller.Library.extend({defaults:f.defaults({id:"insert-image",title:"Insert Image Url",allowLocalEdits:!0,displaySettings:!0,displayUserSettings:!0,multiple:!0,type:"image"},p.media.controller.Library.prototype.defaults)}),(r=p.media({button:{text:"Select"},state:"insert-image",states:[new e]})).on("select",function(){var l=r.state("insert-image"),e=l.get("selection");e&&(d.attr("src",""),o.val(""),e.each(function(e){var i,n=l.display(e).toJSON(),t=e.toJSON(),a=t.caption;p.media.view.settings.captions||delete t.caption,n=p.media.string.props(n,t),i={id:t.id,post_content:t.description,post_excerpt:a},n.linkUrl&&(i.url=n.linkUrl),"image"===t.type?(f.each({align:"align",size:"image-size",alt:"image_alt"},function(e,t){n[t]&&(i[e]=n[t])}),i["image-size"]&&e.attributes.sizes[i["image-size"]]&&(i.url=e.attributes.sizes[i["image-size"]].url)):i.post_title=n.title,d.attr("src",i.url),o.val(i.url),o.addClass("has-image"),o.closest(".tc-upload-image-wrap").addClass("has-image")}),y(i).off("ajaxSuccess.tcadminupload"))}),t=function(){y(".attachment-info").after(y(".attachment-display-settings"))},n=function(){var e=r.state().get("library").toJSON(),a=!0;y.each(e,function(e,i){var n;i.url===o.val()?(n=p.media.attachment(i.id),r.state().get("selection").add(n?[n]:[]),y(".attachment-display-settings").find("select.size").val("full"),a=!1):i.sizes&&y.each(i.sizes,function(e,t){t.url===o.val()&&(n=p.media.attachment(i.id),r.state().get("selection").add(n?[n]:[]),y(".attachment-display-settings").find("select.size").val(e),a=!1)}),a&&y(".attachment-display-settings").find("select.size").val("full")}),t()},r.on("selection:toggle",function(){y(".attachment-display-settings").find("select.size").val("full"),t()}),r.on("close",function(){y(i).off("ajaxSuccess.tcadminupload")}),y(i).off("ajaxSuccess.tcadminupload").on("ajaxSuccess.tcadminupload",function(e,t,i){"query-attachments"===y.epoAPI.util.parseParams(i.data).action&&setTimeout(function(){n()},500)}),r.on("open",function(){n()}),o.data("tm_upload_frame",r),r)).open()},populatePriceVariables:function(e,t,i){var n,a,l=y.epoAPI.util.deepCopyArray(w.map(function(e,n){return e.fields.map(function(e,t){var i=e.find(function(e){return"element_type"===e.id});return i.default&&(i=i.default),e=(e=e.filter(function(e){return null!==e}).find(function(e){return e.id===i+"_uniqid"}))&&e.default,{sectionIndex:n,fieldIndex:t,uniqid:e,type:i}})})),o=y(".tm-element-uniqid").attr("data-uniqid"),d=y('<h4 class="tc-var-header">'+x.i18n_formula_product_variables+"</h4>");e.append(d),d=y('<ul class="tc-var-list product"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{quantity}"><span>'+x.i18n_formula_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price}"><span>'+x.i18n_formula_product_price+"</span></li>"),t||i||d.append('<li class="tc-var-field" data-value="{dynamic_product_price}"><span>'+x.i18n_formula_dynamic_product_price+"</span></li>"),t||(d=y('<h4 class="tc-var-header">'+x.i18n_formula_special_variables+"</h4>"),e.append(d),d=y('<ul class="tc-var-list product"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{options_total}"><span>'+x.i18n_formula_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_options_total}"><span>'+x.i18n_formula_product_price_plus_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{cumulative_total}"><span>'+x.i18n_formula_cumulative_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_cumulative_total}"><span>'+x.i18n_product_price_plus_cumulative_total+"</span></li>")),t||i||(d=y('<h4 class="tc-var-header">'+x.i18n_formula_this_element+"</h4>"),e.append(d),d=y('<ul class="tc-var-list this"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{this.value}"><span>'+x.i18n_formula_this_value+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.value.length}"><span>'+x.i18n_formula_this_value_length+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count}"><span>'+x.i18n_formula_this_count+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count.quantity}"><span>'+x.i18n_formula_this_count_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.quantity}"><span>'+x.i18n_formula_this_quantity+"</span></li>")),l.length&&(d=y('<h4 class="tc-var-header">'+x.i18n_formula_other_elements+"</h4>"),e.append(d),d=y('<div class="tc-clearfix tm-epo-switch-wrapper"><div class="formula-field-mode-selector"><input checked="checked" name="formulamode" class="formula-field-mode" id="formulafieldmode0" value="price" type="radio"><label for="formulafieldmode0"><span title="'+x.i18n_formula_field_price_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_price+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode1" value="value" type="radio"><label for="formulafieldmode1"><span title="'+x.i18n_formula_field_value_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_value+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode4" value="text" type="radio"><label for="formulafieldmode4"><span title="'+x.i18n_formula_field_text_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_text+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode5" value="text.length" type="radio"><label for="formulafieldmode5"><span title="'+x.i18n_formula_field_text_length_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_text_length+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode2"  value="quantity" type="radio"><label for="formulafieldmode2"><span title="'+x.i18n_formula_field_quantity_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_quantity+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode3" value="count" type="radio"><label for="formulafieldmode3"><span title="'+x.i18n_formula_field_count_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_count+"</span></label></div></div>"),e.append(d),d=y('<ul class="tc-var-list other"></ul>'),e.append(d),l.forEach(function(e){e.forEach(function(e){e.uniqid!==o&&void 0!==e.uniqid&&(n=y.tmEPOAdmin.getFieldValue(w[e.sectionIndex].fields[e.fieldIndex],"internal_name",e.type),a=y.tmEPOAdmin.getFieldValue(w[e.sectionIndex].fields[e.fieldIndex],"header_title",e.type),"product"!==e.type)&&"dynamic"!==e.type&&(n=n+(a=""!==(a=void 0===a?"":a)?" ("+a+")":a),d.append('<li title="'+e.uniqid+'" class="tc-var-field" data-value="{field.'+e.uniqid+'.price}"><span>'+n+"</span></li>"))})})),y.tcToolTip(e.find(".tm-tooltip"))}},Array.apply(null,Array(100)).forEach(function(e,t){y.tmEPOAdmin.builderSize["w"+(t+1)]=t+1+"%",11===t&&(y.tmEPOAdmin.builderSize["w12-5"]="12.5%"),32===t&&(y.tmEPOAdmin.builderSize["w33-3"]="33.3%"),36===t&&(y.tmEPOAdmin.builderSize["w37-5"]="37.5%"),61===t&&(y.tmEPOAdmin.builderSize["w62-5"]="62.5%"),86===t&&(y.tmEPOAdmin.builderSize["w87-5"]="87.5%")}),y(function(){h=y.epoAPI.applyFilter("tc_adjust_admin_template_engine",h),a=d.woocommerce_admin,s=d.tinyMCEPreInit,c=d.QTags,m=d.quicktags,u=d.tinyMCE,e=d.TMEPOOPTIONSJS.data,n=d.wc_enhanced_select_params,void 0!==(w=y.epoAPI.util.deepCopyArray(e))&&w||(w=[]),y(".post-type-tm_template_cp").length&&(v=!1),x.is_original_post||(A=v=!1),y.tmEPOAdmin.initialitize(),y.tcToolTip(),l&&y(".tc-admin-extra-product-options_tab").on("click.cpf",function(){y.tmEPOAdmin.makeResizables(y(".builder-wrapper")),y.tmEPOAdmin.makeResizables(y(".bitem")),y(this).off("click.cpf")})})}(window,document,window.jQuery);