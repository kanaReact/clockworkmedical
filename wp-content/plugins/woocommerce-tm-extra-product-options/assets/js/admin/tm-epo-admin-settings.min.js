!function(l,a,d){"use strict";var c=l.TMEPOADMINSETTINGSJS,r=d.epoAPI.util.getStorage("localStorage"),i=l.confirm,o=l.toastr,s=0;function m(e){var t=d("#tm_epo_consent_for_transmit");t.length&&t.is(":checked")&&0===s?(s=1,d(".tm-license-result").html('<div class="activated"><p>'+c.i18n_sending_data+"</p></div>"),d(".tm-license-button").block({message:null}),t={action:"tm_"+e+"_license",username:d("#tm_epo_envato_username").val(),key:d("#tm_epo_envato_purchasecode").val(),api_key:d("#tm_epo_envato_apikey").val(),security:c.settings_nonce},d.post(c.ajax_url,t,function(t){t=t&&-1!==t?t&&t.message&&t.result&&("-3"===t.result||"-2"===t.result||"wp_error"===t.result||"server_error"===t.result)||t&&t.message&&t.result&&"4"===t.result?t.message:"":c.i18n_invalid_request;d(".tm-license-result").html(t),d(".tm-license-button").unblock()},"json").always(function(t){d(".tm-license-button").unblock(),s=0,t&&t.result&&"4"===t.result&&("activate"===e&&(d(".tm-deactivate-license").removeClass("tm-hidden"),d(".tm-activate-license").removeClass("tm-hidden").addClass("tm-hidden")),"deactivate"===e)&&(d(".tm-deactivate-license").removeClass("tm-hidden").addClass("tm-hidden"),d(".tm-activate-license").removeClass("tm-hidden"))})):d(".tm-license-result").html('<div class="error"><p>'+c.i18n_must_concent+"</p></div>")}function p(t){var t=t.val(),e=d("#tm_epo_loading_areas_allowed_ids").closest("tr");-1===d.inArray("specific_ids",t)?e.hide():e.show()}function h(t){var t=t.is(":checked"),e=d("#tm_epo_no_hide_price_if_original_not_zero").closest("tr");t?e.show():e.hide()}function u(t){var t=t.val(),e=d("#tm_epo_options_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function f(t){var t=t.val(),e=d("#tm_epo_totals_box_placement_custom_hook").closest("tr");"custom"===t?e.show():e.hide()}function v(t){var t=t.val(),e=d("#tm_epo_show_options_total").closest("tr"),s=d("#tm_epo_show_final_total").closest("tr"),o=d("#tm_epo_enable_final_total_box_all").closest("tr"),n=d("#tm_epo_enable_original_final_total").closest("tr"),a=d("#tm_epo_enable_vat_options_total").closest("tr"),i=d("#tm_epo_show_unit_price").closest("tr"),l=d("#tm_epo_fees_on_unit_price").closest("tr"),c=d("#tm_epo_total_price_as_unit_price").closest("tr"),r=d("#tm_epo_hide_totals_until_any").closest("tr"),_=d("#tm_epo_hide_totals_until_all_required").closest("tr"),m=d("#tm_epo_hide_totals_until_all").closest("tr");"disable"===t?(e.hide(),s.hide(),o.hide(),n.hide(),a.hide(),i.hide(),l.hide(),c.hide(),r.hide(),_.hide(),m.hide()):(e.show(),s.show(),o.show(),n.show(),a.show(),i.show(),l.show(),c.show(),r.show(),_.show(),m.show(),g(d("#tm_epo_show_options_total")),b(d("#tm_epo_show_final_total")))}function g(t){var t=t.val(),e=d("#tm_epo_enable_vat_options_total").closest("tr");"hide"===t?e.hide():e.show()}function b(t){var t=t.val(),e=d("#tm_epo_enable_original_final_total").closest("tr"),s=d("#tm_epo_total_price_as_unit_price").closest("tr");"hide"===t?(e.hide(),s.hide()):(e.show(),s.show())}function w(t){var t=t.val(),e=d("#tm_epo_options_placement").closest("tr"),s=d("#tm_epo_totals_box_placement").closest("tr"),o=d("#tm_epo_options_placement_custom_hook").closest("tr"),n=d("#tm_epo_totals_box_placement_custom_hook").closest("tr");"action"===t?(e.hide(),s.hide(),o.hide(),n.hide()):(e.show(),s.show(),u(d("#tm_epo_options_placement")),f(d("#tm_epo_totals_box_placement")))}function x(t){var t=t.val(),e=d("#tm_epo_floating_totals_box_visibility").closest("tr"),s=d("#tm_epo_floating_totals_box_add_button").closest("tr"),o=d("#tm_epo_floating_totals_box_pixels").closest("tr");"disable"===t?(e.hide(),s.hide(),o.hide()):(e.show(),s.show(),y(d("#tm_epo_floating_totals_box_visibility")))}function y(t){var t=t.val(),e=d("#tm_epo_floating_totals_box").val(),s=d("#tm_epo_floating_totals_box_pixels").closest("tr");"always"===t||"disable"===e?s.hide():s.show()}function k(t){var t=t.is(":checked"),e=d("#tm_epo_show_price_inside_option_hidden_even").closest("tr"),s=d("#tm_epo_multiply_price_inside_option").closest("tr");t?(e.show(),s.show()):(e.hide(),s.hide())}function C(t){var t=t.is(":checked"),e=d("#tm_epo_show_upload_image_replacement").closest("tr");t?e.hide():e.show()}function I(t){var t=t.is(":checked"),e=d("#tm_epo_show_upload_image_replacement_order").closest("tr");t?e.hide():e.show()}function A(t){t=t.val();d(".tm-epo-field-label").find(".tc-epo-style-wrapper, .tm-epo-style").removeClass("circle circle 2 square square2 round round2").addClass(t)}function j(t){var e=d("#tm_epo_css_styles_style").closest("tr");t.is(":checked")?e.show():e.hide()}function q(t){t=t.val();d(".tm-border-type").removeClass("square circle round shadow thinline").addClass(t)}function n(t){return t.closest("tr")}function D(t,e,s,o){n(s).addClass("tm-hidden"),n(s.filter("."+t)).removeClass("tm-hidden"),o.find(".tm-section-desc .tm-section-menu-item").removeClass("active"),e.addClass("active")}function S(t,e,s){t.block({message:null}),d.post(c.ajax_url,e,function(t){t&&(1===t.error?o.error(t.message,c.i18n_epo):(o.success(t.message,c.i18n_epo),s&&l.location.reload()))},"json").always(function(){t.unblock()})}d(function(){var _,s,o,n,t,e=d(".tm-settings-wrap");0<e.length&&((t=e.find(":checkbox")).closest("label").addClass("tm-epo-switch-wrapper-label"),t.wrap('<span class="tm-epo-switch-wrapper tc"></span>'),t.after('<span class="tc-label tm-epo-switch tc"></span>'),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!0,showPalette:!0,clickoutFiresChange:!1,type:"color",preferredFormat:"hex",theme:"epo",chooseText:c.i18n_close,cancelText:c.i18n_cancel,clearText:""}),d(".forminp .description").toArray().forEach(function(t){t=d(t);t.closest("tr").find(".titledesc").append(t)}),d("#tm_epo_consent_for_transmit").closest("tr").after(d('<tr valign="top"><th scope="row" class="titledesc tm-license-div"></th><td class="forminp forminp-license"></td></tr>')),d(".tm-license-div").append(d(".tm-license-button")),d(".forminp-license").append(d(".tm-license-result")),d(l).on("tc-opentab.tmtabs tc-isopentab.tmtabs",function(t,e){var s,o,n,a=e.table.find(".tm-section-desc .tm-section-menu-item");0<a.length&&(r&&(s=r.getItem("tmadminextratab")),o=a.filter('[data-menu="'+s+'"]'),n=e.table.find("select,input,text,textarea"),D(s=s&&0!==o.length?s:(o=d(a).eq(0)).attr("data-menu"),o,n,e.table))}),d(a).on("keydown.tmtabs",".tm-section-menu-item",function(t){var e,s=d(this);13===t.keyCode&&s.trigger("click"),39===t.keyCode&&(e=s.next(".tm-section-menu-item")),(e=37===t.keyCode?s.prev(".tm-section-menu-item"):e)&&e.length&&(s.trigger("blur"),e.trigger(" focus").trigger("click"),t.preventDefault())}),d(a).on("click",".tm-section-menu-item",function(){var t=d(this),e=t.attr("data-menu"),s=t.closest(".tm-tab");D(e,t,s.find("select,input,text,textarea"),s),r&&r.setItem("tmadminextratab",e)}),d(l).on("tc-tmtabs-clicked",function(t,e){var s,o,n,a,i,l=e.table.find(".tm-section-desc .tm-section-menu-item");0<l.length&&(r&&(s=r.getItem("tmadminextratab")),r&&(o=r.getItem("tmadminextratab-context")),n=e.header.attr(e.options.dataattribute),i=e.table.find("select,input,text,textarea"),s&&o===n?a=l.filter('[data-menu="'+s+'"]'):s=(a=d(l).eq(0)).attr("data-menu"),r&&r.setItem("tmadminextratab-context",n),0<a.length)&&!a.is(".active")&&D(s,a,i,e.table)}),d(a).on("click",".tc-save-button",function(t){var e,s,a,o=d(this).closest("form");e=d("#tm_epo_math"),s=d(".constantrow"),a={},s.toArray().forEach(function(t,e){var t=d(t),s=t.find(".constant-name"),o=s.val(),t=t.find(".constant-value"),n=t.val(),s=s.closest(".constant-label-wrap"),t=t.closest(".constant-label-wrap");""===o?s.addClass("tm-error"):s.removeClass("tm-error"),""===n?t.addClass("tm-error"):t.removeClass("tm-error"),""===o&&""===n||(a["m"+e]={name:String(o),value:String(n)})}),e.val(JSON.stringify(a)),s=o.tcSerializeObject(),s=d.extend(!0,s,{action:"tm_save_settings",save:"save",security:c.settings_nonce}),t.preventDefault(),S(o,s)}),d(a).on("click",".tc-reset-button",function(t){var e,s,o,n,a=d(this).closest("form"),i=d.extend(!0,{},{action:"tm_reset_settings",save:"save",security:c.settings_nonce});t.preventDefault(),t=c.i18n_reset_settings,e=S,s=this,o=[a,i,!0],t=d.epoAPI.template.html(l.wp.template("tc-floatbox"),{id:"tc-floatbox-content",title:t,html:"",uniqid:"",update:c.i18n_yes,cancel:c.i18n_no}),n=!1,d.tcFloatBox({closefadeouttime:0,animateOut:"",width:"50%",height:"auto",classname:"flasho tc-wrapper tc-question",data:t,cancelEvent:function(t){n||(n=!0,t.destroy())},cancelClass:".floatbox-cancel",updateEvent:function(t){n||(n=!0,e.apply(s,o),t.destroy())},updateClass:".floatbox-update"})}),d(".tm-settings-wrap .tm-tabs").tcTabs({scroll:!1,animateDiv:".tm-settings-wrap"}),d(".tm-activate-license").on("click",function(t){t.preventDefault(),m("activate")}),d(".tm-deactivate-license").on("click",function(t){t.preventDefault(),m("deactivate")}),d("#tm_epo_final_total_box").on("change",function(){v(d(this))}),d("#tm_epo_show_options_total").on("change",function(){g(d(this))}),d("#tm_epo_show_final_total").on("change",function(){b(d(this))}),d("#tm_epo_display").on("change",function(){w(d(this))}),d("#tm_epo_options_placement").on("change",function(){u(d(this))}),d("#tm_epo_totals_box_placement").on("change",function(){f(d(this))}),d("#tm_epo_css_styles").on("change",function(){j(d(this))}),d("#tm_epo_css_styles_style").on("change",function(){A(d(this))}),d("#tm_epo_css_selected_border").on("change",function(){q(d(this))}),d("#tm_epo_floating_totals_box").on("change",function(){x(d(this))}),d("#tm_epo_floating_totals_box_visibility").on("change",function(){y(d(this))}),d("#tm_epo_show_price_inside_option").on("change",function(){k(d(this))}),d("#tm_epo_show_hide_uploaded_file_url_cart").on("change",function(){C(d(this))}),d("#tm_epo_show_hide_uploaded_file_url_order").on("change",function(){I(d(this))}),d("#tm_epo_auto_hide_price_if_zero").on("change",function(){h(d(this))}),d("#tm_epo_loading_areas").on("change",function(){p(d(this))}),v(d("#tm_epo_final_total_box")),g(d("#tm_epo_show_options_total")),b(d("#tm_epo_show_final_total")),w(d("#tm_epo_display")),u(d("#tm_epo_options_placement")),f(d("#tm_epo_totals_box_placement")),t=d("#tm_epo_css_styles_style"),d(t).closest("td").css("position","relative").append('<label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="checkbox" checked><span class="tm-epo-style"></span></span></label><label class="tm-epo-field-label"><span class="tc-epo-style-wrapper"><input type="radio" checked><span class="tm-epo-style"></span></span></label>'),A(d("#tm_epo_css_styles_style")),j(d("#tm_epo_css_styles")),e=d("#tm_epo_css_selected_border"),d(e).closest("td").css("position","relative").append('<div class="tm-border-type"></div>'),q(d("#tm_epo_css_selected_border")),x(d("#tm_epo_floating_totals_box")),y(d("#tm_epo_floating_totals_box_visibility")),k(d("#tm_epo_show_price_inside_option")),C(d("#tm_epo_show_hide_uploaded_file_url_cart")),I(d("#tm_epo_show_hide_uploaded_file_url_order")),h(d("#tm_epo_auto_hide_price_if_zero")),p(d("#tm_epo_loading_areas")),t=d("#tm_epo_math"),n="",t.closest("tr").hide(),o=(o=d.epoAPI.util.parseJSON(t.val()))||{},Object.keys(o).forEach(function(t,e){var s=o[t].name,t=o[t].value;n+=d.epoAPI.template.html(l.wp.template("tc-constant-template"),{id:e,labelname:c.i18n_constant_name,labelvalue:c.i18n_constant_value,constantname:s,constantvalue:t,labelnameclass:""===s?" tm-error":"",labelvalueclass:""===t?" tm-error":""})}),d(".tc-constants-container").append(n),d(".tc-constants-container").sortablejs({handle:".constantrow",animation:150}),d(a).on("click",".tc-add-constant",function(){var t=d(this),e=d(".tc-constants-container"),s=d(".constantrow").length,s=d.epoAPI.template.html(l.wp.template("tc-constant-template"),{id:s,labelname:c.i18n_constant_name,labelvalue:c.i18n_constant_value});t.is(".add")?t.closest(".constantrow").after(s):e.append(s)}),d(a).on("click",".tc-constant-delete .delete",function(){d(this).closest(".constantrow").remove()}),d(a).on("change blur keyup",".constant-name, .constant-value",function(){var t=d(this),e=t.closest(".constant-label-wrap");""===t.val()?e.addClass("tm-error"):e.removeClass("tm-error")}),d(a).on("click.cpf",".tm-mn-movetodir,.tm-mn-deldir,.tm-mn-delfile",function(t){var e=d(this),s=d(".forminp-tm_html");t.preventDefault(),0<s.length&&(s.data("doing_ajax")||e.is(".tm-mn-deldir")&&!i(c.i18n_mn_delete_folder)||e.is(".tm-mn-delfile")&&!i(c.i18n_mn_delete_file)||(e.prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),s.data("doing_ajax",1).block({message:null}),t={action:"tm_mn_movetodir",dir:e.attr("data-tm-dir"),security:c.settings_nonce},e.is(".tm-mn-deldir")?(t.action="tm_mn_deldir",t.tmdir=e.attr("data-tm-deldir")):e.is(".tm-mn-delfile")&&(t.action="tm_mn_delfile",t.tmfile=e.attr("data-tm-delfile"),t.tmdir=e.attr("data-tm-deldir")),d.post(c.ajax_url,t,function(t){t&&t.result&&""!==t.result?s.html(t.result):t&&t.error&&t.message&&(t=d.epoAPI.template.html(l.wp.template("tc-floatbox-import"),{id:"tc-floatbox-content",title:c.i18n_error_title,html:'<div class="tm-inner">'+t.message+"</div>",cancel:c.i18n_cancel}),d.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"auto",height:"auto",classname:"flasho tc-wrapper tm-error tc-color-error",data:t}))},"json").always(function(){s.data("doing_ajax",0).unblock(),e.find(".tm-icon").remove()})))}),_=[],s=-1,d(".tm-tab").each(function(){var i=d(this),l=i.find(".tm-section-title").contents().filter(function(){return 3===this.nodeType}).text().trim()||"General",c=Array.from(i.get(0).classList).find(function(t){return t.startsWith("tmsettings")}),r=[];i.find(".tm-section-menu-item").each(function(){r.push(this.dataset.menu)}),i.find("tr").each(function(){var t=d(this),e=t.find(".titledesc label").first(),s=t.find(".description").not(":empty").first(),o=t.find("select,input,text,textarea").first(),n=r.find(function(t){return o.get(0).classList.contains(t)}),a=n?" - "+i.find('[data-menu="'+n+'"]').text():"";e.length&&_.push({$row:t,title:e.text().trim(),description:s.text().trim(),section:l+a,innerSectionClass:n,settingsClass:c,keywords:(e.text()+" "+s.text()).toLowerCase()})})}),d("#tm-settings-search").on("keydown",function(t){var e=d(".tm-search-result-item");switch(t.key){case"ArrowDown":t.preventDefault(),s=Math.min(s+1,e.length-1),e.removeClass("active").eq(s).addClass("active");break;case"ArrowUp":t.preventDefault(),s=Math.max(s-1,0),e.removeClass("active").eq(s).addClass("active");break;case"Enter":t.preventDefault(),e.eq(s).trigger("click");break;case"Escape":d("#tm-search-results").hide()}}),d("#tm-settings-search").on("focus, click",function(){d(this).trigger("input")}),d("#tm-settings-search").on("input",function(){var t,e,s=this.value.trim().toLowerCase(),o=[],n="";if(s.length<2)d("#tm-search-results").empty().hide();else{for(t=0;t<_.length;t++)-1!==_[t].keywords.indexOf(s)&&o.push(_[t]);for(e=0;e<Math.min(o.length,10);e++)n+='<div class="tm-search-result-item" data-title="'+o[e].title+'"><div class="result-title">'+o[e].title+'</div><div class="result-desc">'+o[e].description+'</div><div class="result-section">'+o[e].section+"</div></div>";d("#tm-search-results").html(n||'<div class="tm-no-results">'+c.i18n_no_settings_found+"</div>").show()}}),d(a).on("click",".tm-search-result-item",function(){for(var t,e,s=d(this).data("title"),o=0;o<_.length;o++)if(_[o].title===s){e=_[o];break}e&&(d('[data-id="'+e.settingsClass+'"]').trigger("click"),d('[data-menu="'+e.innerSectionClass+'"]').trigger("click"),(t=e.$row)&&t[0].scrollIntoView({behavior:"smooth",block:"center"}),d("#tm-search-results").empty().hide(),d("#tm-settings-search").val(""))}),d(a).on("click",function(t){d(t.target).closest(".tm-search-container").length||d("#tm-search-results").empty().hide()})),d.tcToolTip()})}(window,document,window.jQuery);